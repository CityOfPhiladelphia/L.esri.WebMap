/* L-esri-WebMap - v0.4.0 - Tue Oct 22 2019 15:21:30 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2019 Yusuke Nunokawa <ynunokawa.dev@gmail.com>
 * MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("leaflet"),require("leaflet-omnivore")):"function"==typeof define&&define.amd?define(["exports","leaflet","leaflet-omnivore"],t):t((e.L=e.L||{},e.L.esri=e.L.esri||{}),e.L,e.omnivore)}(this,function(e,t,n){"use strict";function r(e,t){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function i(e){return r(e[0],e[e.length-1])||e.push(e[0]),e}function a(e){var t,n=0,r=0,i=e.length,a=e[r];for(r;r<i-1;r++)t=e[r+1],n+=(t[0]-a[0])*(t[1]+a[1]),a=t;return n>=0}function o(e,t,n,r){var i=(r[0]-n[0])*(e[1]-n[1])-(r[1]-n[1])*(e[0]-n[0]),a=(t[0]-e[0])*(e[1]-n[1])-(t[1]-e[1])*(e[0]-n[0]),o=(r[1]-n[1])*(t[0]-e[0])-(r[0]-n[0])*(t[1]-e[1]);if(0!==o){var s=i/o,l=a/o;if(s>=0&&s<=1&&l>=0&&l<=1)return!0}return!1}function s(e,t){for(var n=0;n<e.length-1;n++)for(var r=0;r<t.length-1;r++)if(o(e[n],e[n+1],t[r],t[r+1]))return!0;return!1}function l(e,t){for(var n=!1,r=-1,i=e.length,a=i-1;++r<i;a=r)(e[r][1]<=t[1]&&t[1]<e[a][1]||e[a][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[a][0]-e[r][0])*(t[1]-e[r][1])/(e[a][1]-e[r][1])+e[r][0]&&(n=!n);return n}function u(e,t){var n=s(e,t),r=l(e,t[0]);return!(n||!r)}function f(e){for(var t,n,r,o=[],l=[],f=0;f<e.length;f++){var h=i(e[f].slice(0));if(!(h.length<4))if(a(h)){var c=[h];o.push(c)}else l.push(h)}for(var d=[];l.length;){r=l.pop();var p=!1;for(t=o.length-1;t>=0;t--)if(n=o[t][0],u(n,r)){o[t].push(r),p=!0;break}p||d.push(r)}for(;d.length;){r=d.pop();var y=!1;for(t=o.length-1;t>=0;t--)if(n=o[t][0],s(n,r)){o[t].push(r),y=!0;break}y||o.push([r.reverse()])}return 1===o.length?{type:"Polygon",coordinates:o[0]}:{type:"MultiPolygon",coordinates:o}}function h(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function c(e,t){var n={};return"number"==typeof e.x&&"number"==typeof e.y&&(n.type="Point",n.coordinates=[e.x,e.y]),e.points&&(n.type="MultiPoint",n.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(n.type="LineString",n.coordinates=e.paths[0].slice(0)):(n.type="MultiLineString",n.coordinates=e.paths.slice(0))),e.rings&&(n=f(e.rings.slice(0))),(e.geometry||e.attributes)&&(n.type="Feature",n.geometry=e.geometry?c(e.geometry):null,n.properties=e.attributes?h(e.attributes):null,e.attributes&&(n.id=e.attributes[t]||e.attributes.OBJECTID||e.attributes.FID)),JSON.stringify(n.geometry)===JSON.stringify({})&&(n.geometry=null),n}function d(e,t){return new Ce(e,t)}function p(e,t){return new De(e,t)}function y(e,t){return new ke(e,t)}function g(e,t){return new Ne(e,t)}function m(e,t){return new ze(e,t)}function v(e,t){return new Oe(e,t)}function b(e,t){var n,r=e.drawingInfo.renderer,i={};switch(t.options.pane&&(i.pane=t.options.pane),e.drawingInfo.transparency&&(i.layerTransparency=e.drawingInfo.transparency),t.options.style&&(i.userDefinedStyle=t.options.style),r.type){case"classBreaks":if(_(e.geometryType,r,t),t._hasProportionalSymbols){t._createPointLayer();g(r,i).attachStylesToLayer(t._pointLayer),i.proportionalPolygon=!0}n=g(r,i);break;case"uniqueValue":console.log(r,i),n=m(r,i);break;default:n=v(r,i)}n.attachStylesToLayer(t)}function _(e,t,n){if(n._hasProportionalSymbols=!1,"esriGeometryPolygon"===e&&(t.backgroundFillSymbol&&(n._hasProportionalSymbols=!0),t.classBreakInfos&&t.classBreakInfos.length)){var r=t.classBreakInfos[0].symbol;!r||"esriSMS"!==r.type&&"esriPMS"!==r.type||(n._hasProportionalSymbols=!0)}}function w(e,t){return new Ee(e,t)}function S(e,t){return new Ue(e,t)}function x(e,t){return new Fe(e,t)}function M(e){return new Je(e)}function I(e,t){return new We(e,t)}function T(e){var t={position:[],offset:[]};return t.position=e.reverse(),t.offset=[20,20],t}function L(e){var t,n={position:[],offset:[]};return t=Math.round(e.length/2),n.position=e[t].reverse(),n.offset=[0,0],n}function C(e,t){var n={position:[],offset:[]};return n.position=e.getBounds().getCenter(),n.offset=[0,0],n}function D(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function k(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function P(e,t){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=D(e).getTime(),r=k(t);return new Date(n+r)}function N(e){var t=new Date(e.getTime()),n=t.getTimezoneOffset();t.setSeconds(0,0);var r=t.getTime()%qe;return n*qe+r}function z(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=D(e);return!isNaN(t)}function O(e,t,n){n=n||{};var r;return r="string"==typeof Ge[e]?Ge[e]:1===t?Ge[e].one:Ge[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r}function E(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}function U(e,t,n,r){return Be[e]}function F(e){return function(t,n){var r,i=n||{},a=i.context?String(i.context):"standalone";if("formatting"===a&&e.formattingValues){var o=e.defaultFormattingWidth||e.defaultWidth,s=i.width?String(i.width):o;r=e.formattingValues[s]||e.formattingValues[o]}else{var l=e.defaultWidth,u=i.width?String(i.width):e.defaultWidth;r=e.values[u]||e.values[l]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function J(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"}function W(e){return function(t,n){var r=String(t),i=n||{},a=i.width,o=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],s=r.match(o);if(!s)return null;var l,u=s[0],f=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth];return l="[object Array]"===Object.prototype.toString.call(f)?G(f,function(e){return e.test(r)}):q(f,function(e){return e.test(r)}),l=e.valueCallback?e.valueCallback(l):l,l=i.valueCallback?i.valueCallback(l):l,{value:l,rest:r.slice(u.length)}}}function q(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}function G(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}function V(e,t){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");return P(e,-k(t))}function Y(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}function j(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=D(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),i=n-r;return Math.floor(i/yt)+1}function H(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=D(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function B(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=D(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=H(r),a=new Date(0);a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0);var o=H(a);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function A(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=B(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),H(n)}function R(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=D(e),n=H(t).getTime()-A(t).getTime();return Math.round(n/gt)+1}function X(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=t||{},r=n.locale,i=r&&r.options&&r.options.weekStartsOn,a=null==i?0:k(i),o=null==n.weekStartsOn?a:k(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=D(e),l=s.getUTCDay(),u=(l<o?7:0)+l-o;return s.setUTCDate(s.getUTCDate()-u),s.setUTCHours(0,0,0,0),s}function Q(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=D(e,t),r=n.getUTCFullYear(),i=t||{},a=i.locale,o=a&&a.options&&a.options.firstWeekContainsDate,s=null==o?1:k(o),l=null==i.firstWeekContainsDate?s:k(i.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=new Date(0);u.setUTCFullYear(r+1,0,l),u.setUTCHours(0,0,0,0);var f=X(u,t),h=new Date(0);h.setUTCFullYear(r,0,l),h.setUTCHours(0,0,0,0);var c=X(h,t);return n.getTime()>=f.getTime()?r+1:n.getTime()>=c.getTime()?r:r-1}function K(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=t||{},r=n.locale,i=r&&r.options&&r.options.firstWeekContainsDate,a=null==i?1:k(i),o=null==n.firstWeekContainsDate?a:k(n.firstWeekContainsDate),s=Q(e,t),l=new Date(0);return l.setUTCFullYear(s,0,o),l.setUTCHours(0,0,0,0),X(l,t)}function $(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=D(e),r=X(n,t).getTime()-K(n,t).getTime();return Math.round(r/mt)+1}function Z(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),a=r%60;if(0===a)return n+String(i);var o=t||"";return n+String(i)+o+Y(a,2)}function ee(e,t){if(e%60==0){return(e>0?"-":"+")+Y(Math.abs(e)/60,2)}return te(e,t)}function te(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+Y(Math.floor(i/60),2)+n+Y(i%60,2)}function ne(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}}function re(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}}function ie(e,t){var n=e.match(/(P+)(p+)?/),r=n[1],i=n[2];if(!i)return ne(e,t);var a;switch(r){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;case"PPPP":default:a=t.dateTime({width:"full"})}return a.replace("{{date}}",ne(r,t)).replace("{{time}}",re(i,t))}function ae(e){return-1!==wt.indexOf(e)}function oe(e){return-1!==St.indexOf(e)}function se(e){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===e)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===e)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===e)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}function le(e,t,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=String(t),i=n||{},a=i.locale||dt,o=a.options&&a.options.firstWeekContainsDate,s=null==o?1:k(o),l=null==i.firstWeekContainsDate?s:k(i.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=a.options&&a.options.weekStartsOn,f=null==u?0:k(u),h=null==i.weekStartsOn?f:k(i.weekStartsOn);if(!(h>=0&&h<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!a.localize)throw new RangeError("locale must contain localize property");if(!a.formatLong)throw new RangeError("locale must contain formatLong property");var c=D(e);if(!z(c))throw new RangeError("Invalid time value");var d=N(c),p=V(c,d),y={firstWeekContainsDate:l,weekStartsOn:h,locale:a,_originalDate:c};return r.match(Mt).map(function(e){var t=e[0];if("p"===t||"P"===t){return(0,_t[t])(e,a.formatLong,y)}return e}).join("").match(xt).map(function(e){if("''"===e)return"'";var t=e[0];if("'"===t)return ue(e);var n=bt[t];if(n)return!i.useAdditionalWeekYearTokens&&oe(e)&&se(e),!i.useAdditionalDayOfYearTokens&&ae(e)&&se(e),n(p,e,a.localize,y);if(t.match(Lt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return e}).join("")}function ue(e){return e.match(It)[1].replace(Tt,"'")}function fe(e){var t=(""+e).replace(/\D/g,""),n=t.match(/^(\d{3})(\d{3})(\d{4})$/);return n?"("+n[1]+") "+n[2]+"-"+n[3]:null}function he(e){return le(e,"MM/dd/yyyy")}function ce(e){return le(e,"MM/dd/yyyy hh:mm a")}function de(e,t){var n=/\{([^\]]*)\}/g,r="",i="";void 0!==e.title&&(r=e.title),r=r.replace(n,function(r){for(var i=n.exec(r),a=t[i[1]],o=0;o<e.fieldInfos.length;o++)e.fieldInfos[o].fieldName===i[1]&&e.fieldInfos[o].format&&("shortDate"!==e.fieldInfos[o].format.dateFormat&&"shortDateShortTime"!==e.fieldInfos[o].format.dateFormat||(a=he(t[e.fieldInfos[o].fieldName])));return a}),i='<div class="leaflet-popup-content-title text-center"><h4>'+r+'</h4></div><div class="leaflet-popup-content-description" style="max-height:200px;overflow:auto;">';var a='<div style="font-weight:bold;color:#999;margin-top:5px;word-break:break-all;">',o='</div><p style="margin-top:0;margin-bottom:5px;word-break:break-all;">';if(void 0!==e.fieldInfos){for(var s=0;s<e.fieldInfos.length;s++)!0===e.fieldInfos[s].visible&&(null===t[e.fieldInfos[s].fieldName]?i+=a+e.fieldInfos[s].label+o+"none</p>":"URL"===e.fieldInfos[s].fieldName||"CODE_SEC_1"===e.fieldInfos[s].fieldName||"WEBSITE"===e.fieldInfos[s].fieldName||"FINAL_LINK_COPY"===e.fieldInfos[s].fieldName||"LINK"===e.fieldInfos[s].fieldName||"Permit Link"===e.fieldInfos[s].fieldName||"PermitURL"===e.fieldInfos[s].fieldName||e.fieldInfos[s].fieldName.toLowerCase().includes("url")||e.fieldInfos[s].fieldName.toLowerCase().includes("link")||"CODE_SECTION_LINK"===e.fieldInfos[s].fieldName?i+=a+e.fieldInfos[s].label+o+'<a target="_blank" href="'+t[e.fieldInfos[s].fieldName]+'">'+t[e.fieldInfos[s].fieldName]+"</a></p>":e.fieldInfos[s].fieldName.includes("EMAIL")?i+=a+e.fieldInfos[s].label+o+'<a href="mailto:'+t[e.fieldInfos[s].fieldName]+'">'+t[e.fieldInfos[s].fieldName]+"</a></p>":e.fieldInfos[s].fieldName.includes("PHONE")?i+=a+e.fieldInfos[s].label+o+fe(t[e.fieldInfos[s].fieldName])+"</p>":e.fieldInfos[s].fieldName.includes("time")?(console.log("includes time"),i+=a+e.fieldInfos[s].label+o+ce(t[e.fieldInfos[s].fieldName])+"</p>"):e.fieldInfos[s].fieldName.includes("DATE")?(console.log("includes date"),i+=a+e.fieldInfos[s].label+o+he(t[e.fieldInfos[s].fieldName])+"</p>"):e.fieldInfos[s].format&&("shortDate"===e.fieldInfos[s].format.dateFormat||"shortDateShortTime"===e.fieldInfos[s].format.dateFormat)?(console.log("is shortDate or shortDateShortTime"),i+=a+e.fieldInfos[s].label+o+he(t[e.fieldInfos[s].fieldName])+"</p>"):i+=a+e.fieldInfos[s].label+o+t[e.fieldInfos[s].fieldName]+"</p>");i+="</div>"}else if(void 0!==e.description){var l=e.description.replace(n,function(e){var r=n.exec(e);return t[r[1]]});i+=l+"</div>"}return i}function pe(e,t,n,r,i){return ye(e,t,n,r,i)}function ye(e,n,r,i,a){var o,s,l,u,f=[],h=a+"-label";if("Feature Collection"===e.type||void 0!==e.featureCollection){r.createPane(h);var c,d;if(void 0===e.itemId)for(l=0,u=e.featureCollection.layers.length;l<u;l++)e.featureCollection.layers[l].featureSet.features.length>0&&(void 0!==e.featureCollection.layers[l].popupInfo&&null!==e.featureCollection.layers[l].popupInfo&&(c=e.featureCollection.layers[l].popupInfo),void 0!==e.featureCollection.layers[l].layerDefinition.drawingInfo.labelingInfo&&null!==e.featureCollection.layers[l].layerDefinition.drawingInfo.labelingInfo&&(d=e.featureCollection.layers[l].layerDefinition.drawingInfo.labelingInfo));s=t.featureGroup(f);var p=w(null,{data:e.itemId||e.featureCollection,opacity:e.opacity,pane:a,onEachFeature:function(t,n){if(n.feature.layerName=e.title.split("_")[1],void 0!==p&&(c=p.popupInfo,d=p.labelingInfo),void 0!==c&&null!==c){var r=de(c,t.properties);n.feature.popupHtml=r}if(void 0!==d&&null!==d){var i,a=n.feature.geometry.coordinates;i="Point"===n.feature.geometry.type?T(a):"LineString"===n.feature.geometry.type?L(a):"MultiLineString"===n.feature.geometry.type?L(a[Math.round(a.length/2)]):C(n);var o=I(i.position,{zIndexOffset:1,properties:t.properties,labelingInfo:d,offset:i.offset,pane:h});s.addLayer(o)}}});return o=t.layerGroup([p,s]),n.push({type:"FC",title:e.title||"",layer:o}),o}if("ArcGISFeatureLayer"===e.layerType&&void 0!==e.layerDefinition){var y="1=1";if(void 0!==e.layerDefinition.drawingInfo){if("heatmap"===e.layerDefinition.drawingInfo.renderer.type){var g={};return e.layerDefinition.drawingInfo.renderer.colorStops.map(function(e){g[(Math.round(100*e.ratio)/100+6)/7]="rgb("+e.color[0]+","+e.color[1]+","+e.color[2]+")"}),o=t.esri.Heat.heatmapFeatureLayer({url:e.url,token:i.token||null,minOpacity:.5,max:e.layerDefinition.drawingInfo.renderer.maxPixelIntensity,blur:e.layerDefinition.drawingInfo.renderer.blurRadius,radius:1.3*e.layerDefinition.drawingInfo.renderer.blurRadius,gradient:g,pane:a}),n.push({type:"HL",title:e.title||"",layer:o}),o}var m=e.layerDefinition.drawingInfo;return m.transparency=100-100*e.opacity,void 0!==e.layerDefinition.definitionExpression&&(y=e.layerDefinition.definitionExpression),r.createPane(h),s=t.featureGroup(f),o=t.esri.featureLayer({url:e.url,where:y,token:i.token||null,drawingInfo:m,pane:a,onEachFeature:function(t,n){if(n.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=de(e.popupInfo,t.properties);n.feature.popupHtml=r}if(void 0!==e.layerDefinition.drawingInfo.labelingInfo&&null!==e.layerDefinition.drawingInfo.labelingInfo){var i,a=e.layerDefinition.drawingInfo.labelingInfo,o=n.feature.geometry.coordinates;i="Point"===n.feature.geometry.type?T(o):"LineString"===n.feature.geometry.type?L(o):"MultiLineString"===n.feature.geometry.type?L(o[Math.round(o.length/2)]):C(n);var l=I(i.position,{zIndexOffset:1,properties:t.properties,labelingInfo:a,offset:i.offset,pane:h});s.addLayer(l)}}}),o=t.layerGroup([o,s]),n.push({type:"FL",title:e.title||"",layer:o}),o}return void 0!==e.layerDefinition.definitionExpression&&(y=e.layerDefinition.definitionExpression),o=t.esri.featureLayer({url:e.url,token:i.token||null,where:y,pane:a,onEachFeature:function(t,n){if(n.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=de(e.popupInfo,t.properties);n.feature.popupHtml=r}}}),n.push({type:"FL",title:e.title||"",layer:o}),o}if("ArcGISFeatureLayer"===e.layerType)return o=t.esri.featureLayer({url:e.url,token:i.token||null,pane:a,onEachFeature:function(t,n){if(n.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=de(e.popupInfo,t.properties);n.feature.popupHtml=r}}}),n.push({type:"FL",title:e.title||"",layer:o}),o;if("CSV"===e.layerType)return s=t.featureGroup(f),o=S(null,{url:e.url,layerDefinition:e.layerDefinition,locationInfo:e.locationInfo,opacity:e.opacity,pane:a,onEachFeature:function(t,n){if(n.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=de(e.popupInfo,t.properties);n.feature.popupHtml=r}if(void 0!==e.layerDefinition.drawingInfo.labelingInfo&&null!==e.layerDefinition.drawingInfo.labelingInfo){var i,a=e.layerDefinition.drawingInfo.labelingInfo,o=n.feature.geometry.coordinates;i="Point"===n.feature.geometry.type?T(o):"LineString"===n.feature.geometry.type?L(o):"MultiLineString"===n.feature.geometry.type?L(o[Math.round(o.length/2)]):C(n);var l=I(i.position,{zIndexOffset:1,properties:t.properties,labelingInfo:a,offset:i.offset,pane:h});s.addLayer(l)}}}),o=t.layerGroup([o,s]),n.push({type:"CSV",title:e.title||"",layer:o}),o;if("KML"===e.layerType){s=t.featureGroup(f);var v=x(null,{url:e.url,opacity:e.opacity,pane:a,onEachFeature:function(t,n){if(n.feature.layerName=e.title.split("_")[1],void 0!==v.popupInfo&&null!==v.popupInfo){var r=de(v.popupInfo,t.properties);n.feature.popupHtml=r}if(void 0!==v.labelingInfo&&null!==v.labelingInfo){var i,a=v.labelingInfo,o=n.feature.geometry.coordinates;i="Point"===n.feature.geometry.type?T(o):"LineString"===n.feature.geometry.type?L(o):"MultiLineString"===n.feature.geometry.type?L(o[Math.round(o.length/2)]):C(n);var l=I(i.position,{zIndexOffset:1,properties:t.properties,labelingInfo:a,offset:i.offset,pane:h});s.addLayer(l)}}});return o=t.layerGroup([v,s]),n.push({type:"KML",title:e.title||"",layer:o}),o}if("ArcGISImageServiceLayer"===e.layerType)return o=t.esri.imageMapLayer({url:e.url,token:i.token||null,pane:a,opacity:e.opacity||1}),n.push({type:"IML",title:e.title||"",layer:o}),o;if("ArcGISMapServiceLayer"===e.layerType)return o=t.esri.dynamicMapLayer({url:e.url,token:i.token||null,pane:a,opacity:e.opacity||1}),n.push({type:"DML",title:e.title||"",layer:o}),o;if("ArcGISTiledMapServiceLayer"===e.layerType){try{o=t.esri.basemapLayer(e.title)}catch(n){o=t.esri.tiledMapLayer({url:e.url,token:i.token||null}),t.esri.request(e.url,{},function(e,t){if(e)console.log(e);else{var n=r.getSize().x-55,i='<span class="esri-attributions" style="line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block; max-width:'+n+'px;">'+t.copyrightText+"</span>";r.attributionControl.addAttribution(i)}})}return document.getElementsByClassName("leaflet-tile-pane")[0].style.opacity=e.opacity||1,n.push({type:"TML",title:e.title||"",layer:o}),o}if("VectorTileLayer"===e.layerType){var b={"World Street Map (with Relief)":"StreetsRelief","World Street Map (with Relief) (Mature Support)":"StreetsRelief","Hybrid Reference Layer":"Hybrid","Hybrid Reference Layer (Mature Support)":"Hybrid","World Street Map":"Streets","World Street Map (Mature Support)":"Streets","World Street Map (Night)":"StreetsNight","World Street Map (Night) (Mature Support)":"StreetsNight","Dark Gray Canvas":"DarkGray","Dark Gray Canvas (Mature Support)":"DarkGray","World Topographic Map":"Topographic","World Topographic Map (Mature Support)":"Topographic","World Navigation Map":"Navigation","World Navigation Map (Mature Support)":"Navigation","Light Gray Canvas":"Gray","Light Gray Canvas (Mature Support)":"Gray"};return b[e.title]?o=t.esri.Vector.basemap(b[e.title]):(console.error("Unsupported Vector Tile Layer: ",e),o=t.featureGroup([])),n.push({type:"VTL",title:e.title||e.id||"",layer:o}),o}if("OpenStreetMap"===e.layerType)return o=t.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),n.push({type:"TL",title:e.title||e.id||"",layer:o}),o;if("WebTiledLayer"===e.layerType){var _=ge(e.templateUrl);return o=t.tileLayer(_,{attribution:e.copyright}),document.getElementsByClassName("leaflet-tile-pane")[0].style.opacity=e.opacity||1,n.push({type:"TL",title:e.title||e.id||"",layer:o}),o}if("WMS"===e.layerType){var M="";for(l=0,u=e.visibleLayers.length;l<u;l++)M+=e.visibleLayers[l],l<u-1&&(M+=",");return o=t.tileLayer.wms(e.url,{layers:String(M),format:"image/png",transparent:!0,attribution:e.copyright}),n.push({type:"WMS",title:e.title||e.id||"",layer:o}),o}return o=t.featureGroup([]),console.log("Unsupported Layer: ",e),o}function ge(e){var t=e;return t=t.replace(/\{level}/g,"{z}"),t=t.replace(/\{col}/g,"{x}"),t=t.replace(/\{row}/g,"{y}")}function me(e,t){return new Ct(e,t)}t="default"in t?t.default:t,n="default"in n?n.default:n;var ve=t.Class.extend({initialize:function(e,t){this._symbolJson=e,this.val=null,this._styles={},this._isDefault=!1,this._layerTransparency=1,t&&t.layerTransparency&&(this._layerTransparency=1-t.layerTransparency/100)},pixelValue:function(e){return 1.333*e},colorValue:function(e){return"rgb("+e[0]+","+e[1]+","+e[2]+")"},alphaValue:function(e){return e[3]/255*this._layerTransparency},getSize:function(e,t){var n=e.properties,r=t.field,i=0,a=null;if(r){a=n[r];var o,s=t.minSize,l=t.maxSize,u=t.minDataValue,f=t.maxDataValue,h=t.normalizationField,c=n?parseFloat(n[h]):void 0;if(null===a||h&&(isNaN(c)||0===c))return null;isNaN(c)||(a/=c),null!==s&&null!==l&&null!==u&&null!==f&&(a<=u?i=s:a>=f?i=l:(o=(a-u)/(f-u),i=s+o*(l-s))),i=isNaN(i)?0:i}return i},getColor:function(e,t){if(!(e.properties&&t&&t.field&&t.stops))return null;var n,r,i,a,o=e.properties,s=o[t.field],l=t.normalizationField,u=o?parseFloat(o[l]):void 0;if(null===s||l&&(isNaN(u)||0===u))return null;if(isNaN(u)||(s/=u),s<=t.stops[0].value)return t.stops[0].color;var f=t.stops[t.stops.length-1];if(s>=f.value)return f.color;for(var h=0;h<t.stops.length;h++){var c=t.stops[h];if(c.value<=s)n=c.color,i=c.value;else if(c.value>s){r=c.color,a=c.value;break}}if(!isNaN(i)&&!isNaN(a)){var d=a-i;if(d>0){var p=(s-i)/d;if(p){var y=(a-s)/d;if(y){for(var g=[],m=0;m<4;m++)g[m]=Math.round(n[m]*y+r[m]*p);return g}return r}return n}}return null}}),be=t.Path.extend({initialize:function(e,n,r){t.setOptions(this,r),this._size=n,this._latlng=t.latLng(e),this._svgCanvasIncludes()},toGeoJSON:function(){return t.GeoJSON.getFeature(this,{type:"Point",coordinates:t.GeoJSON.latLngToCoords(this.getLatLng())})},_svgCanvasIncludes:function(){},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_update:function(){this._map&&this._updatePath()},_updatePath:function(){},setLatLng:function(e){return this._latlng=t.latLng(e),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setSize:function(e){return this._size=e,this.redraw()},getSize:function(){return this._size}}),_e=be.extend({initialize:function(e,t,n){be.prototype.initialize.call(this,e,t,n)},_updatePath:function(){this._renderer._updateCrossMarker(this)},_svgCanvasIncludes:function(){t.Canvas.include({_updateCrossMarker:function(e){var t=e._point,n=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(t.x,t.y+n),r.lineTo(t.x,t.y-n),this._fillStroke(r,e),r.moveTo(t.x-n,t.y),r.lineTo(t.x+n,t.y),this._fillStroke(r,e)}}),t.SVG.include({_updateCrossMarker:function(e){var n=e._point,r=e._size/2;t.Browser.vml&&(n._round(),r=Math.round(r));var i="M"+n.x+","+(n.y+r)+"L"+n.x+","+(n.y-r)+"M"+(n.x-r)+","+n.y+"L"+(n.x+r)+","+n.y;this._setPath(e,i)}})}}),we=function(e,t,n){return new _e(e,t,n)},Se=be.extend({initialize:function(e,t,n){be.prototype.initialize.call(this,e,t,n)},_updatePath:function(){this._renderer._updateXMarker(this)},_svgCanvasIncludes:function(){t.Canvas.include({_updateXMarker:function(e){var t=e._point,n=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(t.x+n,t.y+n),r.lineTo(t.x-n,t.y-n),this._fillStroke(r,e)}}),t.SVG.include({_updateXMarker:function(e){var n=e._point,r=e._size/2;t.Browser.vml&&(n._round(),r=Math.round(r));var i="M"+(n.x+r)+","+(n.y+r)+"L"+(n.x-r)+","+(n.y-r)+"M"+(n.x-r)+","+(n.y+r)+"L"+(n.x+r)+","+(n.y-r);this._setPath(e,i)}})}}),xe=function(e,t,n){return new Se(e,t,n)},Me=be.extend({options:{fill:!0},initialize:function(e,t,n){be.prototype.initialize.call(this,e,t,n)},_updatePath:function(){this._renderer._updateSquareMarker(this)},_svgCanvasIncludes:function(){t.Canvas.include({_updateSquareMarker:function(e){var t=e._point,n=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(t.x+n,t.y+n),r.lineTo(t.x-n,t.y+n),r.lineTo(t.x-n,t.y-n),r.lineTo(t.x+n,t.y-n),r.closePath(),this._fillStroke(r,e)}}),t.SVG.include({_updateSquareMarker:function(e){var n=e._point,r=e._size/2;t.Browser.vml&&(n._round(),r=Math.round(r));var i="M"+(n.x+r)+","+(n.y+r)+"L"+(n.x-r)+","+(n.y+r)+"L"+(n.x-r)+","+(n.y-r)+"L"+(n.x+r)+","+(n.y-r);i+=t.Browser.svg?"z":"x",this._setPath(e,i)}})}}),Ie=function(e,t,n){return new Me(e,t,n)},Te=be.extend({options:{fill:!0},initialize:function(e,t,n){be.prototype.initialize.call(this,e,t,n)},_updatePath:function(){this._renderer._updateDiamondMarker(this)},_svgCanvasIncludes:function(){t.Canvas.include({_updateDiamondMarker:function(e){var t=e._point,n=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(t.x,t.y+n),r.lineTo(t.x-n,t.y),r.lineTo(t.x,t.y-n),r.lineTo(t.x+n,t.y),r.closePath(),this._fillStroke(r,e)}}),t.SVG.include({_updateDiamondMarker:function(e){var n=e._point,r=e._size/2;t.Browser.vml&&(n._round(),r=Math.round(r));var i="M"+n.x+","+(n.y+r)+"L"+(n.x-r)+","+n.y+"L"+n.x+","+(n.y-r)+"L"+(n.x+r)+","+n.y;i+=t.Browser.svg?"z":"x",this._setPath(e,i)}})}}),Le=function(e,t,n){return new Te(e,t,n)},Ce=ve.extend({statics:{MARKERTYPES:["esriSMSCircle","esriSMSCross","esriSMSDiamond","esriSMSSquare","esriSMSX","esriPMS"]},initialize:function(e,t){var n;if(ve.prototype.initialize.call(this,e,t),t&&(this.serviceUrl=t.url),e)if("esriPMS"===e.type){var r=this._symbolJson.url;r&&"http://"===r.substr(0,7)||"https://"===r.substr(0,8)?(n=this.sanitize(r),this._iconUrl=n):(n=this.serviceUrl+"images/"+r,this._iconUrl=t&&t.token?n+"?token="+t.token:n),e.imageData&&(this._iconUrl="data:"+e.contentType+";base64,"+e.imageData),this._icons={},this.icon=this._createIcon(this._symbolJson)}else this._fillStyles()},sanitize:function(e){if(!e)return"";var t;try{t=e.replace(/<br>/gi,"\n"),t=t.replace(/<p.*>/gi,"\n"),t=t.replace(/<a.*href='(.*?)'.*>(.*?)<\/a>/gi," $2 ($1) "),t=t.replace(/<(?:.|\s)*?>/g,"")}catch(e){t=null}return t},_fillStyles:function(){this._symbolJson.outline&&this._symbolJson.size>0&&"esriSLSNull"!==this._symbolJson.outline.style?(this._styles.stroke=!0,this._styles.weight=this.pixelValue(this._symbolJson.outline.width),this._styles.color=this.colorValue(this._symbolJson.outline.color),this._styles.opacity=this.alphaValue(this._symbolJson.outline.color)):this._styles.stroke=!1,this._symbolJson.color?(this._styles.fillColor=this.colorValue(this._symbolJson.color),this._styles.fillOpacity=this.alphaValue(this._symbolJson.color)):this._styles.fillOpacity=0,"esriSMSCircle"===this._symbolJson.style&&(this._styles.radius=this.pixelValue(this._symbolJson.size)/2)},_createIcon:function(e){var n=this.pixelValue(e.width),r=n;e.height&&(r=this.pixelValue(e.height));var i=n/2,a=r/2;e.xoffset&&(i+=this.pixelValue(e.xoffset)),e.yoffset&&(a+=this.pixelValue(e.yoffset));var o=t.icon({iconUrl:this._iconUrl,iconSize:[n,r],iconAnchor:[i,a]});return this._icons[e.width.toString()]=o,o},_getIcon:function(e){var t=this._icons[e.toString()];return t||(t=this._createIcon({width:e})),t},pointToLayer:function(e,n,r,i){var a=this._symbolJson.size||this._symbolJson.width;if(!this._isDefault){if(r.sizeInfo){var o=this.getSize(e,r.sizeInfo);o&&(a=o)}if(r.colorInfo){var s=this.getColor(e,r.colorInfo);s&&(this._styles.fillColor=this.colorValue(s),this._styles.fillOpacity=this.alphaValue(s))}}if("esriPMS"===this._symbolJson.type){var l=t.extend({},{icon:this._getIcon(a)},i);return t.marker(n,l)}switch(a=this.pixelValue(a),this._symbolJson.style){case"esriSMSSquare":return Ie(n,a,t.extend({},this._styles,i));case"esriSMSDiamond":return Le(n,a,t.extend({},this._styles,i));case"esriSMSCross":return we(n,a,t.extend({},this._styles,i));case"esriSMSX":return xe(n,a,t.extend({},this._styles,i))}return this._styles.radius=a/2,t.circleMarker(n,t.extend({},this._styles,i))}}),De=ve.extend({statics:{LINETYPES:["esriSLSDash","esriSLSDot","esriSLSDashDotDot","esriSLSDashDot","esriSLSSolid"]},initialize:function(e,t){ve.prototype.initialize.call(this,e,t),this._fillStyles()},_fillStyles:function(){if(this._styles.lineCap="butt",this._styles.lineJoin="miter",this._styles.fill=!1,this._styles.weight=0,!this._symbolJson)return this._styles;if(this._symbolJson.color&&(this._styles.color=this.colorValue(this._symbolJson.color),this._styles.opacity=this.alphaValue(this._symbolJson.color)),!isNaN(this._symbolJson.width)){this._styles.weight=this.pixelValue(this._symbolJson.width);var e=[];switch(this._symbolJson.style){case"esriSLSDash":e=[4,3];break;case"esriSLSDot":e=[1,3];break;case"esriSLSDashDot":e=[8,3,1,3];break;case"esriSLSDashDotDot":e=[8,3,1,3,1,3]}if(e.length>0){for(var t=0;t<e.length;t++)e[t]*=this._styles.weight;this._styles.dashArray=e.join(",")}}},style:function(e,t){
if(!this._isDefault&&t){if(t.sizeInfo){var n=this.pixelValue(this.getSize(e,t.sizeInfo));n&&(this._styles.weight=n)}if(t.colorInfo){var r=this.getColor(e,t.colorInfo);r&&(this._styles.color=this.colorValue(r),this._styles.opacity=this.alphaValue(r))}}return this._styles}}),ke=ve.extend({statics:{POLYGONTYPES:["esriSFSSolid"]},initialize:function(e,t){ve.prototype.initialize.call(this,e,t),e&&(e.outline&&"esriSLSNull"===e.outline.style?this._lineStyles={weight:0}:this._lineStyles=p(e.outline,t).style(),this._fillStyles())},_fillStyles:function(){if(this._lineStyles)if(0===this._lineStyles.weight)this._styles.stroke=!1;else for(var e in this._lineStyles)this._styles[e]=this._lineStyles[e];this._symbolJson&&(this._symbolJson.color&&ke.POLYGONTYPES.indexOf(this._symbolJson.style>=0)?(this._styles.fill=!0,this._styles.fillColor=this.colorValue(this._symbolJson.color),this._styles.fillOpacity=this.alphaValue(this._symbolJson.color)):(this._styles.fill=!1,this._styles.fillOpacity=0))},style:function(e,t){if(!this._isDefault&&t&&t.colorInfo){var n=this.getColor(e,t.colorInfo);n&&(this._styles.fillColor=this.colorValue(n),this._styles.fillOpacity=this.alphaValue(n))}return this._styles}}),Pe=t.Class.extend({options:{proportionalPolygon:!1,clickable:!0},initialize:function(e,n){this._rendererJson=e,this._pointSymbols=!1,this._symbols=[],this._visualVariables=this._parseVisualVariables(e.visualVariables),t.Util.setOptions(this,n)},_parseVisualVariables:function(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n].type]=e[n];return t},_createDefaultSymbol:function(){this._rendererJson.defaultSymbol&&(this._defaultSymbol=this._newSymbol(this._rendererJson.defaultSymbol),this._defaultSymbol._isDefault=!0)},_newSymbol:function(e){return"esriSMS"===e.type||"esriPMS"===e.type?(this._pointSymbols=!0,d(e,this.options)):"esriSLS"===e.type?p(e,this.options):"esriSFS"===e.type?y(e,this.options):void 0},_getSymbol:function(){},attachStylesToLayer:function(e){this._pointSymbols?e.options.pointToLayer=t.Util.bind(this.pointToLayer,this):(e.options.style=t.Util.bind(this.style,this),e._originalStyle=e.options.style)},pointToLayer:function(e,n){var r=this._getSymbol(e);return r&&r.pointToLayer?r.pointToLayer(e,n,this._visualVariables,this.options):t.circleMarker(n,{radius:0,opacity:0})},style:function(e){var t;this.options.userDefinedStyle&&(t=this.options.userDefinedStyle(e));var n=this._getSymbol(e);return n?this.mergeStyles(n.style(e,this._visualVariables),t):this.mergeStyles({opacity:0,fillOpacity:0},t)},mergeStyles:function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);if(t)for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r}}),Ne=Pe.extend({initialize:function(e,t){Pe.prototype.initialize.call(this,e,t),this._field=this._rendererJson.field,this._rendererJson.normalizationType&&"esriNormalizeByField"===this._rendererJson.normalizationType&&(this._normalizationField=this._rendererJson.normalizationField),this._createSymbols()},_createSymbols:function(){var e,t=this._rendererJson.classBreakInfos;this._symbols=[];for(var n=t.length-1;n>=0;n--)e=this.options.proportionalPolygon&&this._rendererJson.backgroundFillSymbol?this._newSymbol(this._rendererJson.backgroundFillSymbol):this._newSymbol(t[n].symbol),e.val=t[n].classMaxValue,this._symbols.push(e);this._symbols.sort(function(e,t){return e.val>t.val?1:-1}),this._createDefaultSymbol(),this._maxValue=this._symbols[this._symbols.length-1].val},_getSymbol:function(e){var t=e.properties[this._field];if(this._normalizationField){var n=e.properties[this._normalizationField];if(isNaN(n)||0===n)return this._defaultSymbol;t/=n}if(t>this._maxValue)return this._defaultSymbol;for(var r=this._symbols[0],i=this._symbols.length-1;i>=0&&!(t>this._symbols[i].val);i--)r=this._symbols[i];return r}}),ze=Pe.extend({initialize:function(e,t){Pe.prototype.initialize.call(this,e,t),this._field=this._rendererJson.field1,this._createSymbols()},_createSymbols:function(){for(var e,t=this._rendererJson.uniqueValueInfos,n=t.length-1;n>=0;n--)e=this._newSymbol(t[n].symbol),e.val=t[n].value,this._symbols.push(e);this._createDefaultSymbol()},_getSymbol:function(e){var t=e.properties[this._field];if(this._rendererJson.fieldDelimiter&&this._rendererJson.field2){var n=e.properties[this._rendererJson.field2];if(n){t+=this._rendererJson.fieldDelimiter+n;var r=e.properties[this._rendererJson.field3];r&&(t+=this._rendererJson.fieldDelimiter+r)}}for(var i=this._defaultSymbol,a=this._symbols.length-1;a>=0;a--)this._symbols[a].val==t&&(i=this._symbols[a]);return i}}),Oe=Pe.extend({initialize:function(e,t){Pe.prototype.initialize.call(this,e,t),this._createSymbol()},_createSymbol:function(){this._rendererJson.symbol&&this._symbols.push(this._newSymbol(this._rendererJson.symbol))},_getSymbol:function(){return this._symbols[0]}}),Ee=t.GeoJSON.extend({options:{data:{},opacity:1},initialize:function(e,n){t.setOptions(this,n),this.data=this.options.data,this.opacity=this.options.opacity,this.popupInfo=null,this.labelingInfo=null,this._layers={};var r,i;if(e)for(r=0,i=e.length;r<i;r++)this.addLayer(e[r]);"string"==typeof this.data?this._getFeatureCollection(this.data):this._parseFeatureCollection(this.data)},_getFeatureCollection:function(e){var n="https://www.arcgis.com/sharing/rest/content/items/"+e+"/data";t.esri.request(n,{},function(e,t){e?console.log(e):this._parseFeatureCollection(t)},this)},_parseFeatureCollection:function(e){var t,n,r=0;for(t=0,n=e.layers.length;t<n;t++)e.layers[t].featureSet.features.length>0&&(r=t);var i=e.layers[r].featureSet.features,a=e.layers[r].layerDefinition.geometryType,o=e.layers[r].layerDefinition.objectIdField,s=e.layers[r].layerDefinition||null;4326!==e.layers[r].layerDefinition.extent.spatialReference.wkid&&(102100!==e.layers[r].layerDefinition.extent.spatialReference.wkid&&console.error("[L.esri.WebMap] this wkid ("+e.layers[r].layerDefinition.extent.spatialReference.wkid+") is not supported."),i=this._projTo4326(i,a)),void 0!==e.layers[r].popupInfo&&(this.popupInfo=e.layers[r].popupInfo),void 0!==e.layers[r].layerDefinition.drawingInfo.labelingInfo&&(this.labelingInfo=e.layers[r].layerDefinition.drawingInfo.labelingInfo),console.log(e);var l=this._featureCollectionToGeoJSON(i,o);null!==s&&b(s,this),console.log(l),this.addData(l)},_projTo4326:function(e,n){console.log("_project!");var r,i,a=[];for(r=0,i=e.length;r<i;r++){var o,s,l,u=e[r];if("esriGeometryPoint"===n)o=t.Projection.SphericalMercator.unproject(t.point(u.geometry.x,u.geometry.y)),u.geometry.x=o.lng,u.geometry.y=o.lat;else if("esriGeometryMultipoint"===n){var f;for(s=0,f=u.geometry.points.length;s<f;s++)o=t.Projection.SphericalMercator.unproject(t.point(u.geometry.points[s][0],u.geometry.points[s][1])),u.geometry.points[s][0]=o.lng,u.geometry.points[s][1]=o.lat}else if("esriGeometryPolyline"===n){var h,c;for(s=0,c=u.geometry.paths.length;s<c;s++)for(l=0,h=u.geometry.paths[s].length;l<h;l++)o=t.Projection.SphericalMercator.unproject(t.point(u.geometry.paths[s][l][0],u.geometry.paths[s][l][1])),u.geometry.paths[s][l][0]=o.lng,u.geometry.paths[s][l][1]=o.lat}else if("esriGeometryPolygon"===n){var d,p;for(s=0,p=u.geometry.rings.length;s<p;s++)for(l=0,d=u.geometry.rings[s].length;l<d;l++)o=t.Projection.SphericalMercator.unproject(t.point(u.geometry.rings[s][l][0],u.geometry.rings[s][l][1])),u.geometry.rings[s][l][0]=o.lng,u.geometry.rings[s][l][1]=o.lat}a.push(u)}return a},_featureCollectionToGeoJSON:function(e,t){var n,r,i={type:"FeatureCollection",features:[]},a=[];for(n=0,r=e.length;n<r;n++){var o=c(e[n],t);a.push(o)}return i.features=a,i}}),Ue=t.GeoJSON.extend({options:{url:"",data:{},opacity:1},initialize:function(e,n){t.setOptions(this,n),this.url=this.options.url,this.layerDefinition=this.options.layerDefinition,this.locationInfo=this.options.locationInfo,this.opacity=this.options.opacity,this._layers={};var r,i;if(e)for(r=0,i=e.length;r<i;r++)this.addLayer(e[r]);this._parseCSV(this.url,this.layerDefinition,this.locationInfo)},_parseCSV:function(e,t,r){n.csv(e,{latfield:r.latitudeFieldName,lonfield:r.longitudeFieldName},this),b(t,this)}}),Fe=t.GeoJSON.extend({options:{opacity:1,url:""},initialize:function(e,n){t.setOptions(this,n),this.url=this.options.url,this.opacity=this.options.opacity,this.popupInfo=null,this.labelingInfo=null,this._layers={};var r,i;if(e)for(r=0,i=e.length;r<i;r++)this.addLayer(e[r]);this._getKML(this.url)},_getKML:function(e){var n="http://utility.arcgis.com/sharing/kml?url="+e+'&model=simple&folders=&outSR=%7B"wkid"%3A4326%7D';t.esri.request(n,{},function(e,t){e?console.log(e):(console.log(t),this._parseFeatureCollection(t.featureCollection))},this)},_parseFeatureCollection:function(e){console.log("_parseFeatureCollection");var t;for(t=0;t<3;t++)if(e.layers[t].featureSet.features.length>0){console.log(t);var n=e.layers[t].featureSet.features,r=e.layers[t].layerDefinition.objectIdField,i=this._featureCollectionToGeoJSON(n,r);void 0!==e.layers[t].popupInfo&&(this.popupInfo=e.layers[t].popupInfo),void 0!==e.layers[t].layerDefinition.drawingInfo.labelingInfo&&(this.labelingInfo=e.layers[t].layerDefinition.drawingInfo.labelingInfo),b(e.layers[t].layerDefinition,this),console.log(i),this.addData(i)}},_featureCollectionToGeoJSON:function(e,t){var n,r,i={type:"FeatureCollection",features:[]},a=[];for(n=0,r=e.length;n<r;n++){var o=c(e[n],t);a.push(o)}return i.features=a,i}}),Je=t.DivIcon.extend({options:{iconSize:null,className:"esri-leaflet-webmap-labels",text:""},createIcon:function(e){var n=e&&"DIV"===e.tagName?e:document.createElement("div"),r=this.options;if(n.innerHTML='<div style="position: relative; left: -50%; text-shadow: 1px 1px 0px #fff, -1px 1px 0px #fff, 1px -1px 0px #fff, -1px -1px 0px #fff;">'+r.text+"</div>",n.style.fontSize="1em",n.style.fontWeight="bold",n.style.textTransform="uppercase",n.style.textAlign="center",n.style.whiteSpace="nowrap",r.bgPos){var i=t.point(r.bgPos);n.style.backgroundPosition=-i.x+"px "+-i.y+"px"}return this._setIconStyles(n,"icon"),n}}),We=t.Marker.extend({options:{properties:{},labelingInfo:{},offset:[0,0]},initialize:function(e,n){t.setOptions(this,n),this._latlng=t.latLng(e);var r=this._createLabelText(this.options.properties,this.options.labelingInfo);this._setLabelIcon(r,this.options.offset)},_createLabelText:function(e,t){var n=/\[([^\]]*)\]/g,r=t[0].labelExpression;return r=r.replace(n,function(t){var r=n.exec(t);return e[r[1]]})},_setLabelIcon:function(e,t){var n=M({text:e,iconAnchor:t});this.setIcon(n)}}),qe=6e4,Ge={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ve={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ye={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},je={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},He={date:E({formats:Ve,defaultWidth:"full"}),time:E({formats:Ye,defaultWidth:"full"}),dateTime:E({formats:je,defaultWidth:"full"})},Be={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ae={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Re={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Xe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Qe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ke={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Ze={ordinalNumber:J,era:F({values:Ae,defaultWidth:"wide"}),quarter:F({values:Re,defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:F({values:Xe,defaultWidth:"wide"}),day:F({values:Qe,defaultWidth:"wide"}),dayPeriod:F({values:Ke,defaultWidth:"wide",formattingValues:$e,defaultFormattingWidth:"wide"})},et=/^(\d+)(th|st|nd|rd)?/i,tt=/\d+/i,nt={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},rt={any:[/^b/i,/^(a|c)/i]},it={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},at={any:[/1/i,/2/i,/3/i,/4/i]},ot={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},st={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},lt={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ut={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ft={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ht={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ct={ordinalNumber:function(e){return function(t,n){var r=String(t),i=n||{},a=r.match(e.matchPattern);if(!a)return null;var o=a[0],s=r.match(e.parsePattern);if(!s)return null;var l=e.valueCallback?e.valueCallback(s[0]):s[0];return l=i.valueCallback?i.valueCallback(l):l,{value:l,rest:r.slice(o.length)}}}({matchPattern:et,parsePattern:tt,valueCallback:function(e){return parseInt(e,10)}}),era:W({matchPatterns:nt,defaultMatchWidth:"wide",parsePatterns:rt,defaultParseWidth:"any"}),quarter:W({matchPatterns:it,defaultMatchWidth:"wide",parsePatterns:at,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:W({matchPatterns:ot,defaultMatchWidth:"wide",parsePatterns:st,defaultParseWidth:"any"}),day:W({matchPatterns:lt,defaultMatchWidth:"wide",parsePatterns:ut,defaultParseWidth:"any"}),dayPeriod:W({matchPatterns:ft,defaultMatchWidth:"any",parsePatterns:ht,defaultParseWidth:"any"})},dt={code:"en-US",formatDistance:O,formatLong:He,formatRelative:U,localize:Ze,match:ct,options:{weekStartsOn:0,firstWeekContainsDate:1}},pt={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return Y("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):Y(n+1,2)},d:function(e,t){return Y(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.toUpperCase();case"aaaaa":return n[0];case"aaaa":default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return Y(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Y(e.getUTCHours(),t.length)},m:function(e,t){return Y(e.getUTCMinutes(),t.length)},s:function(e,t){return Y(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return Y(Math.floor(r*Math.pow(10,n-3)),t.length)}},yt=864e5,gt=6048e5,mt=6048e5,vt={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},bt={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return pt.y(e,t)},Y:function(e,t,n,r){var i=Q(e,r),a=i>0?i:1-i;if("YY"===t){return Y(a%100,2)}return"Yo"===t?n.ordinalNumber(a,{unit:"year"}):Y(a,t.length)},R:function(e,t){return Y(B(e),t.length)},u:function(e,t){return Y(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return Y(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return Y(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return pt.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return Y(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=$(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):Y(i,t.length)},I:function(e,t,n){var r=R(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):Y(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):pt.d(e,t)},D:function(e,t,n){var r=j(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):Y(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return Y(a,2);case"eo":return n.ordinalNumber(a,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),a=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return Y(a,t.length);case"co":return n.ordinalNumber(a,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return Y(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours(),i=r/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?vt.noon:0===i?vt.midnight:i/12>=1?"pm":"am",t){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?vt.evening:i>=12?vt.afternoon:i>=4?vt.morning:vt.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return pt.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):pt.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):Y(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):Y(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):pt.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):pt.s(e,t)},S:function(e,t){return pt.S(e,t)},X:function(e,t,n,r){var i=r._originalDate||e,a=i.getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return ee(a);case"XXXX":case"XX":return te(a);case"XXXXX":case"XXX":default:return te(a,":")}},x:function(e,t,n,r){var i=r._originalDate||e,a=i.getTimezoneOffset();switch(t){case"x":return ee(a);case"xxxx":case"xx":return te(a);case"xxxxx":case"xxx":default:return te(a,":")}},O:function(e,t,n,r){var i=r._originalDate||e,a=i.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Z(a,":");case"OOOO":default:return"GMT"+te(a,":")}},z:function(e,t,n,r){var i=r._originalDate||e,a=i.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Z(a,":");case"zzzz":default:return"GMT"+te(a,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return Y(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return Y((r._originalDate||e).getTime(),t.length)}},_t={p:re,P:ie},wt=["D","DD"],St=["YY","YYYY"],xt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Mt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,It=/^'([^]*?)'?$/,Tt=/''/g,Lt=/[a-zA-Z]/,Ct=t.Evented.extend({options:{map:{},token:null,server:"www.arcgis.com"},initialize:function(e,n){t.setOptions(this,n),this._map=this.options.map,this._token=this.options.token,this._server=this.options.server,this._webmapId=e,this._loaded=!1,this._metadataLoaded=!1,this._loadedLayersNum=0,this._layersNum=0,this.layers=[],this.title="",this.bookmarks=[],this.portalItem={},this.VERSION="0.4.0",this._loadWebMapMetaData(e),this._loadWebMap(e)},_checkLoaded:function(){++this._loadedLayersNum===this._layersNum&&(this._loaded=!0,this.fire("load"))},_operationalLayer:function(e,t,n,r,i){var a=pe(e,t,n,r,i);void 0!==a&&!0===e.visibility&&a.addTo(n)},_loadWebMapMetaData:function(e){var n={},r=this._map,i=this,a="https://"+this._server+"/sharing/rest/content/items/"+e;this._token&&this._token.length>0&&(n.token=this._token),t.esri.request(a,n,function(e,t){e?console.log(e):(i.portalItem=t,i.title=t.title,i._metadataLoaded=!0,i.fire("metadataLoad"),r.fitBounds([t.extent[0].reverse(),t.extent[1].reverse()]))})},_loadWebMap:function(e){var n=this._map,r=this.layers,i=this._server,a={},o="https://"+i+"/sharing/rest/content/items/"+e+"/data";this._token&&this._token.length>0&&(a.token=this._token),t.esri.request(o,a,function(e,o){e?console.log("L.esri.request error:",e):(this._layersNum=o.baseMap.baseMapLayers.length+o.operationalLayers.length,o.baseMap.baseMapLayers.map(function(o){if(void 0!==o.itemId){var s="https://"+i+"/sharing/rest/content/items/"+o.itemId;t.esri.request(s,a,function(t,i){t?console.error(e):(console.log(i.access),"public"!==i.access?this._operationalLayer(o,r,n,a):this._operationalLayer(o,r,n,{})),this._checkLoaded()},this)}else this._operationalLayer(o,r,n,{}),this._checkLoaded()}.bind(this)),o.operationalLayers.map(function(o,s){var l="esri-webmap-layer"+s;if(n.createPane(l),void 0!==o.itemId){var u="https://"+i+"/sharing/rest/content/items/"+o.itemId;t.esri.request(u,a,function(t,i){t?console.error(e):(console.log(i.access),"public"!==i.access?this._operationalLayer(o,r,n,a,l):this._operationalLayer(o,r,n,{},l)),this._checkLoaded()},this)}else this._operationalLayer(o,r,n,{},l),this._checkLoaded()}.bind(this)),void 0!==o.bookmarks&&o.bookmarks.length>0&&o.bookmarks.map(function(e){var n=t.Projection.SphericalMercator.unproject(t.point(e.extent.xmax,e.extent.ymax)),r=t.Projection.SphericalMercator.unproject(t.point(e.extent.xmin,e.extent.ymin)),i=t.latLngBounds(r,n);this.bookmarks.push({name:e.name,bounds:i})}.bind(this)))}.bind(this))}});e.WebMap=Ct,e.webMap=me,e.operationalLayer=pe,e.FeatureCollection=Ee,e.featureCollection=w,e.LabelMarker=We,e.labelMarker=I,e.LabelIcon=Je,e.labelIcon=M,e.createPopupContent=de,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=esri-leaflet-webmap.js.map