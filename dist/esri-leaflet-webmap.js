/* esri-leaflet-webmap - v0.4.0 - Fri Mar 08 2019 12:53:36 GMT-0500 (Eastern Standard Time)
 * Copyright (c) 2019 Yusuke Nunokawa <ynunokawa.dev@gmail.com>
 * MIT */
!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("leaflet"),require("leaflet-omnivore")):"function"==typeof define&&define.amd?define(["exports","leaflet","leaflet-omnivore"],i):i((e.L=e.L||{},e.L.esri=e.L.esri||{}),e.L,e.omnivore)}(this,function(e,i,t){"use strict";function r(e,i){for(var t=0;t<e.length;t++)if(e[t]!==i[t])return!1;return!0}function s(e){return r(e[0],e[e.length-1])||e.push(e[0]),e}function n(e){var i,t=0,r=0,s=e.length,n=e[r];for(r;r<s-1;r++)i=e[r+1],t+=(i[0]-n[0])*(i[1]+n[1]),n=i;return t>=0}function o(e,i,t,r){var s=(r[0]-t[0])*(e[1]-t[1])-(r[1]-t[1])*(e[0]-t[0]),n=(i[0]-e[0])*(e[1]-t[1])-(i[1]-e[1])*(e[0]-t[0]),o=(r[1]-t[1])*(i[0]-e[0])-(r[0]-t[0])*(i[1]-e[1]);if(0!==o){var a=s/o,l=n/o;if(a>=0&&a<=1&&l>=0&&l<=1)return!0}return!1}function a(e,i){for(var t=0;t<e.length-1;t++)for(var r=0;r<i.length-1;r++)if(o(e[t],e[t+1],i[r],i[r+1]))return!0;return!1}function l(e,i){for(var t=!1,r=-1,s=e.length,n=s-1;++r<s;n=r)(e[r][1]<=i[1]&&i[1]<e[n][1]||e[n][1]<=i[1]&&i[1]<e[r][1])&&i[0]<(e[n][0]-e[r][0])*(i[1]-e[r][1])/(e[n][1]-e[r][1])+e[r][0]&&(t=!t);return t}function u(e,i){var t=a(e,i),r=l(e,i[0]);return!(t||!r)}function f(e){for(var i,t,r,o=[],l=[],f=0;f<e.length;f++){var d=s(e[f].slice(0));if(!(d.length<4))if(n(d)){var p=[d];o.push(p)}else l.push(d)}for(var y=[];l.length;){r=l.pop();var h=!1;for(i=o.length-1;i>=0;i--)if(t=o[i][0],u(t,r)){o[i].push(r),h=!0;break}h||y.push(r)}for(;y.length;){r=y.pop();var c=!1;for(i=o.length-1;i>=0;i--)if(t=o[i][0],a(t,r)){o[i].push(r),c=!0;break}c||o.push([r.reverse()])}return 1===o.length?{type:"Polygon",coordinates:o[0]}:{type:"MultiPolygon",coordinates:o}}function d(e){var i={};for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function p(e,i){var t={};return"number"==typeof e.x&&"number"==typeof e.y&&(t.type="Point",t.coordinates=[e.x,e.y]),e.points&&(t.type="MultiPoint",t.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(t.type="LineString",t.coordinates=e.paths[0].slice(0)):(t.type="MultiLineString",t.coordinates=e.paths.slice(0))),e.rings&&(t=f(e.rings.slice(0))),(e.geometry||e.attributes)&&(t.type="Feature",t.geometry=e.geometry?p(e.geometry):null,t.properties=e.attributes?d(e.attributes):null,e.attributes&&(t.id=e.attributes[i]||e.attributes.OBJECTID||e.attributes.FID)),JSON.stringify(t.geometry)===JSON.stringify({})&&(t.geometry=null),t}function y(e,i){return new R(e,i)}function h(e,i){return new A(e,i)}function c(e,i){return new U(e,i)}function _(e,i){return new K(e,i)}function g(e,i){return new X(e,i)}function m(e,i){return new $(e,i)}function x(e,i){var t,r=e.drawingInfo.renderer,s={};switch(i.options.pane&&(s.pane=i.options.pane),e.drawingInfo.transparency&&(s.layerTransparency=e.drawingInfo.transparency),i.options.style&&(s.userDefinedStyle=i.options.style),r.type){case"classBreaks":if(v(e.geometryType,r,i),i._hasProportionalSymbols){i._createPointLayer();_(r,s).attachStylesToLayer(i._pointLayer),s.proportionalPolygon=!0}t=_(r,s);break;case"uniqueValue":console.log(r,s),t=g(r,s);break;default:t=m(r,s)}t.attachStylesToLayer(i)}function v(e,i,t){if(t._hasProportionalSymbols=!1,"esriGeometryPolygon"===e&&(i.backgroundFillSymbol&&(t._hasProportionalSymbols=!0),i.classBreakInfos&&i.classBreakInfos.length)){var r=i.classBreakInfos[0].symbol;!r||"esriSMS"!==r.type&&"esriPMS"!==r.type||(t._hasProportionalSymbols=!0)}}function S(e,i){return new Z(e,i)}function b(e,i){return new ee(e,i)}function I(e,i){return new ie(e,i)}function q(e){return new te(e)}function j(e,i){return new re(e,i)}function L(e){var i={position:[],offset:[]};return i.position=e.reverse(),i.offset=[20,20],i}function M(e){var i,t={position:[],offset:[]};return i=Math.round(e.length/2),t.position=e[i].reverse(),t.offset=[0,0],t}function k(e,i){var t={position:[],offset:[]};return t.position=e.getBounds().getCenter(),t.offset=[0,0],t}function w(e){var i=(""+e).replace(/\D/g,""),t=i.match(/^(\d{3})(\d{3})(\d{4})$/);return t?"("+t[1]+") "+t[2]+"-"+t[3]:null}function D(e){return(void 0)(e,"MM/DD/YYYY")}function O(e,i){var t=/\{([^\]]*)\}/g,r="",s="";void 0!==e.title&&(r=e.title),r=r.replace(t,function(e){var r=t.exec(e);return i[r[1]]}),s='<div class="leaflet-popup-content-title text-center"><h4>'+r+'</h4></div><div class="leaflet-popup-content-description" style="max-height:200px;overflow:auto;">';var n='<div style="font-weight:bold;color:#999;margin-top:5px;word-break:break-all;">',o='</div><p style="margin-top:0;margin-bottom:5px;word-break:break-all;">';if(void 0!==e.fieldInfos){for(var a=0;a<e.fieldInfos.length;a++)!0===e.fieldInfos[a].visible&&(null===i[e.fieldInfos[a].fieldName]?s+=n+e.fieldInfos[a].label+o+"none</p>":"URL"===e.fieldInfos[a].fieldName||"CODE_SEC_1"===e.fieldInfos[a].fieldName||"WEBSITE"===e.fieldInfos[a].fieldName||"FINAL_LINK_COPY"===e.fieldInfos[a].fieldName||"LINK"===e.fieldInfos[a].fieldName||"CODE_SECTION_LINK"===e.fieldInfos[a].fieldName?s+=n+e.fieldInfos[a].label+o+'<a target="_blank" href="'+i[e.fieldInfos[a].fieldName]+'">'+i[e.fieldInfos[a].fieldName]+"</a></p>":e.fieldInfos[a].fieldName.includes("EMAIL")?s+=n+e.fieldInfos[a].label+o+'<a href="mailto:'+i[e.fieldInfos[a].fieldName]+'">'+i[e.fieldInfos[a].fieldName]+"</a></p>":e.fieldInfos[a].fieldName.includes("PHONE")?s+=n+e.fieldInfos[a].label+o+w(i[e.fieldInfos[a].fieldName])+"</p>":e.fieldInfos[a].fieldName.includes("DATE")?s+=n+e.fieldInfos[a].label+o+D(i[e.fieldInfos[a].fieldName])+"</p>":s+=n+e.fieldInfos[a].label+o+i[e.fieldInfos[a].fieldName]+"</p>");s+="</div>"}else if(void 0!==e.description){var l=e.description.replace(t,function(e){var r=t.exec(e);return i[r[1]]});s+=l+"</div>"}return s}function T(e,i,t,r,s){return N(e,i,t,r,s)}function N(e,t,r,s,n){var o,a,l,u,f=[],d=n+"-label";if("Feature Collection"===e.type||void 0!==e.featureCollection){r.createPane(d);var p,y;if(void 0===e.itemId)for(l=0,u=e.featureCollection.layers.length;l<u;l++)e.featureCollection.layers[l].featureSet.features.length>0&&(void 0!==e.featureCollection.layers[l].popupInfo&&null!==e.featureCollection.layers[l].popupInfo&&(p=e.featureCollection.layers[l].popupInfo),void 0!==e.featureCollection.layers[l].layerDefinition.drawingInfo.labelingInfo&&null!==e.featureCollection.layers[l].layerDefinition.drawingInfo.labelingInfo&&(y=e.featureCollection.layers[l].layerDefinition.drawingInfo.labelingInfo));a=i.featureGroup(f);var h=S(null,{data:e.itemId||e.featureCollection,opacity:e.opacity,pane:n,onEachFeature:function(i,t){if(t.feature.layerName=e.title.split("_")[1],void 0!==h&&(p=h.popupInfo,y=h.labelingInfo),void 0!==p&&null!==p){var r=O(p,i.properties);t.feature.popupHtml=r}if(void 0!==y&&null!==y){var s,n=t.feature.geometry.coordinates;s="Point"===t.feature.geometry.type?L(n):"LineString"===t.feature.geometry.type?M(n):"MultiLineString"===t.feature.geometry.type?M(n[Math.round(n.length/2)]):k(t);var o=j(s.position,{zIndexOffset:1,properties:i.properties,labelingInfo:y,offset:s.offset,pane:d});a.addLayer(o)}}});return o=i.layerGroup([h,a]),t.push({type:"FC",title:e.title||"",layer:o}),o}if("ArcGISFeatureLayer"===e.layerType&&void 0!==e.layerDefinition){var c="1=1";if(void 0!==e.layerDefinition.drawingInfo){if("heatmap"===e.layerDefinition.drawingInfo.renderer.type){var _={};return e.layerDefinition.drawingInfo.renderer.colorStops.map(function(e){_[(Math.round(100*e.ratio)/100+6)/7]="rgb("+e.color[0]+","+e.color[1]+","+e.color[2]+")"}),o=i.esri.Heat.heatmapFeatureLayer({url:e.url,token:s.token||null,minOpacity:.5,max:e.layerDefinition.drawingInfo.renderer.maxPixelIntensity,blur:e.layerDefinition.drawingInfo.renderer.blurRadius,radius:1.3*e.layerDefinition.drawingInfo.renderer.blurRadius,gradient:_,pane:n}),t.push({type:"HL",title:e.title||"",layer:o}),o}var g=e.layerDefinition.drawingInfo;return g.transparency=100-100*e.opacity,void 0!==e.layerDefinition.definitionExpression&&(c=e.layerDefinition.definitionExpression),r.createPane(d),a=i.featureGroup(f),o=i.esri.featureLayer({url:e.url,where:c,token:s.token||null,drawingInfo:g,pane:n,onEachFeature:function(i,t){if(t.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=O(e.popupInfo,i.properties);t.feature.popupHtml=r}if(void 0!==e.layerDefinition.drawingInfo.labelingInfo&&null!==e.layerDefinition.drawingInfo.labelingInfo){var s,n=e.layerDefinition.drawingInfo.labelingInfo,o=t.feature.geometry.coordinates;s="Point"===t.feature.geometry.type?L(o):"LineString"===t.feature.geometry.type?M(o):"MultiLineString"===t.feature.geometry.type?M(o[Math.round(o.length/2)]):k(t);var l=j(s.position,{zIndexOffset:1,properties:i.properties,labelingInfo:n,offset:s.offset,pane:d});a.addLayer(l)}}}),o=i.layerGroup([o,a]),t.push({type:"FL",title:e.title||"",layer:o}),o}return void 0!==e.layerDefinition.definitionExpression&&(c=e.layerDefinition.definitionExpression),o=i.esri.featureLayer({url:e.url,token:s.token||null,where:c,pane:n,onEachFeature:function(i,t){if(t.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=O(e.popupInfo,i.properties);t.feature.popupHtml=r}}}),t.push({type:"FL",title:e.title||"",layer:o}),o}if("ArcGISFeatureLayer"===e.layerType)return o=i.esri.featureLayer({url:e.url,token:s.token||null,pane:n,onEachFeature:function(i,t){if(t.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=O(e.popupInfo,i.properties);t.feature.popupHtml=r}}}),t.push({type:"FL",title:e.title||"",layer:o}),o;if("CSV"===e.layerType)return a=i.featureGroup(f),o=b(null,{url:e.url,layerDefinition:e.layerDefinition,locationInfo:e.locationInfo,opacity:e.opacity,pane:n,onEachFeature:function(i,t){if(t.feature.layerName=e.title.split("_")[1],void 0!==e.popupInfo){var r=O(e.popupInfo,i.properties);t.feature.popupHtml=r}if(void 0!==e.layerDefinition.drawingInfo.labelingInfo&&null!==e.layerDefinition.drawingInfo.labelingInfo){var s,n=e.layerDefinition.drawingInfo.labelingInfo,o=t.feature.geometry.coordinates;s="Point"===t.feature.geometry.type?L(o):"LineString"===t.feature.geometry.type?M(o):"MultiLineString"===t.feature.geometry.type?M(o[Math.round(o.length/2)]):k(t);var l=j(s.position,{zIndexOffset:1,properties:i.properties,labelingInfo:n,offset:s.offset,pane:d});a.addLayer(l)}}}),o=i.layerGroup([o,a]),t.push({type:"CSV",title:e.title||"",layer:o}),o;if("KML"===e.layerType){a=i.featureGroup(f);var m=I(null,{url:e.url,opacity:e.opacity,pane:n,onEachFeature:function(i,t){if(t.feature.layerName=e.title.split("_")[1],void 0!==m.popupInfo&&null!==m.popupInfo){var r=O(m.popupInfo,i.properties);t.feature.popupHtml=r}if(void 0!==m.labelingInfo&&null!==m.labelingInfo){var s,n=m.labelingInfo,o=t.feature.geometry.coordinates;s="Point"===t.feature.geometry.type?L(o):"LineString"===t.feature.geometry.type?M(o):"MultiLineString"===t.feature.geometry.type?M(o[Math.round(o.length/2)]):k(t);var l=j(s.position,{zIndexOffset:1,properties:i.properties,labelingInfo:n,offset:s.offset,pane:d});a.addLayer(l)}}});return o=i.layerGroup([m,a]),t.push({type:"KML",title:e.title||"",layer:o}),o}if("ArcGISImageServiceLayer"===e.layerType)return o=i.esri.imageMapLayer({url:e.url,token:s.token||null,pane:n,opacity:e.opacity||1}),t.push({type:"IML",title:e.title||"",layer:o}),o;if("ArcGISMapServiceLayer"===e.layerType)return o=i.esri.dynamicMapLayer({url:e.url,token:s.token||null,pane:n,opacity:e.opacity||1}),t.push({type:"DML",title:e.title||"",layer:o}),o;if("ArcGISTiledMapServiceLayer"===e.layerType){try{o=i.esri.basemapLayer(e.title)}catch(t){o=i.esri.tiledMapLayer({url:e.url,token:s.token||null}),i.esri.request(e.url,{},function(e,i){if(e)console.log(e);else{var t=r.getSize().x-55,s='<span class="esri-attributions" style="line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block; max-width:'+t+'px;">'+i.copyrightText+"</span>";r.attributionControl.addAttribution(s)}})}return document.getElementsByClassName("leaflet-tile-pane")[0].style.opacity=e.opacity||1,t.push({type:"TML",title:e.title||"",layer:o}),o}if("VectorTileLayer"===e.layerType){var x={"World Street Map (with Relief)":"StreetsRelief","World Street Map (with Relief) (Mature Support)":"StreetsRelief","Hybrid Reference Layer":"Hybrid","Hybrid Reference Layer (Mature Support)":"Hybrid","World Street Map":"Streets","World Street Map (Mature Support)":"Streets","World Street Map (Night)":"StreetsNight","World Street Map (Night) (Mature Support)":"StreetsNight","Dark Gray Canvas":"DarkGray","Dark Gray Canvas (Mature Support)":"DarkGray","World Topographic Map":"Topographic","World Topographic Map (Mature Support)":"Topographic","World Navigation Map":"Navigation","World Navigation Map (Mature Support)":"Navigation","Light Gray Canvas":"Gray","Light Gray Canvas (Mature Support)":"Gray"};return x[e.title]?o=i.esri.Vector.basemap(x[e.title]):(console.error("Unsupported Vector Tile Layer: ",e),o=i.featureGroup([])),t.push({type:"VTL",title:e.title||e.id||"",layer:o}),o}if("OpenStreetMap"===e.layerType)return o=i.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),t.push({type:"TL",title:e.title||e.id||"",layer:o}),o;if("WebTiledLayer"===e.layerType){var v=C(e.templateUrl);return o=i.tileLayer(v,{attribution:e.copyright}),document.getElementsByClassName("leaflet-tile-pane")[0].style.opacity=e.opacity||1,t.push({type:"TL",title:e.title||e.id||"",layer:o}),o}if("WMS"===e.layerType){var q="";for(l=0,u=e.visibleLayers.length;l<u;l++)q+=e.visibleLayers[l],l<u-1&&(q+=",");return o=i.tileLayer.wms(e.url,{layers:String(q),format:"image/png",transparent:!0,attribution:e.copyright}),t.push({type:"WMS",title:e.title||e.id||"",layer:o}),o}return o=i.featureGroup([]),console.log("Unsupported Layer: ",e),o}function C(e){var i=e;return i=i.replace(/\{level}/g,"{z}"),i=i.replace(/\{col}/g,"{x}"),i=i.replace(/\{row}/g,"{y}")}function z(e,i){return new se(e,i)}i="default"in i?i.default:i,t="default"in t?t.default:t;var P=i.Class.extend({initialize:function(e,i){this._symbolJson=e,this.val=null,this._styles={},this._isDefault=!1,this._layerTransparency=1,i&&i.layerTransparency&&(this._layerTransparency=1-i.layerTransparency/100)},pixelValue:function(e){return 1.333*e},colorValue:function(e){return"rgb("+e[0]+","+e[1]+","+e[2]+")"},alphaValue:function(e){return e[3]/255*this._layerTransparency},getSize:function(e,i){var t=e.properties,r=i.field,s=0,n=null;if(r){n=t[r];var o,a=i.minSize,l=i.maxSize,u=i.minDataValue,f=i.maxDataValue,d=i.normalizationField,p=t?parseFloat(t[d]):void 0;if(null===n||d&&(isNaN(p)||0===p))return null;isNaN(p)||(n/=p),null!==a&&null!==l&&null!==u&&null!==f&&(n<=u?s=a:n>=f?s=l:(o=(n-u)/(f-u),s=a+o*(l-a))),s=isNaN(s)?0:s}return s},getColor:function(e,i){if(!(e.properties&&i&&i.field&&i.stops))return null;var t,r,s,n,o=e.properties,a=o[i.field],l=i.normalizationField,u=o?parseFloat(o[l]):void 0;if(null===a||l&&(isNaN(u)||0===u))return null;if(isNaN(u)||(a/=u),a<=i.stops[0].value)return i.stops[0].color;var f=i.stops[i.stops.length-1];if(a>=f.value)return f.color;for(var d=0;d<i.stops.length;d++){var p=i.stops[d];if(p.value<=a)t=p.color,s=p.value;else if(p.value>a){r=p.color,n=p.value;break}}if(!isNaN(s)&&!isNaN(n)){var y=n-s;if(y>0){var h=(a-s)/y;if(h){var c=(n-a)/y;if(c){for(var _=[],g=0;g<4;g++)_[g]=Math.round(t[g]*c+r[g]*h);return _}return r}return t}}return null}}),J=i.Path.extend({initialize:function(e,t,r){i.setOptions(this,r),this._size=t,this._latlng=i.latLng(e),this._svgCanvasIncludes()},toGeoJSON:function(){return i.GeoJSON.getFeature(this,{type:"Point",coordinates:i.GeoJSON.latLngToCoords(this.getLatLng())})},_svgCanvasIncludes:function(){},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_update:function(){this._map&&this._updatePath()},_updatePath:function(){},setLatLng:function(e){return this._latlng=i.latLng(e),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setSize:function(e){return this._size=e,this.redraw()},getSize:function(){return this._size}}),V=J.extend({initialize:function(e,i,t){J.prototype.initialize.call(this,e,i,t)},_updatePath:function(){this._renderer._updateCrossMarker(this)},_svgCanvasIncludes:function(){i.Canvas.include({_updateCrossMarker:function(e){var i=e._point,t=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(i.x,i.y+t),r.lineTo(i.x,i.y-t),this._fillStroke(r,e),r.moveTo(i.x-t,i.y),r.lineTo(i.x+t,i.y),this._fillStroke(r,e)}}),i.SVG.include({_updateCrossMarker:function(e){var t=e._point,r=e._size/2;i.Browser.vml&&(t._round(),r=Math.round(r));var s="M"+t.x+","+(t.y+r)+"L"+t.x+","+(t.y-r)+"M"+(t.x-r)+","+t.y+"L"+(t.x+r)+","+t.y;this._setPath(e,s)}})}}),F=function(e,i,t){return new V(e,i,t)},W=J.extend({initialize:function(e,i,t){J.prototype.initialize.call(this,e,i,t)},_updatePath:function(){this._renderer._updateXMarker(this)},_svgCanvasIncludes:function(){i.Canvas.include({_updateXMarker:function(e){var i=e._point,t=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(i.x+t,i.y+t),r.lineTo(i.x-t,i.y-t),this._fillStroke(r,e)}}),i.SVG.include({_updateXMarker:function(e){var t=e._point,r=e._size/2;i.Browser.vml&&(t._round(),r=Math.round(r));var s="M"+(t.x+r)+","+(t.y+r)+"L"+(t.x-r)+","+(t.y-r)+"M"+(t.x-r)+","+(t.y+r)+"L"+(t.x+r)+","+(t.y-r);this._setPath(e,s)}})}}),G=function(e,i,t){return new W(e,i,t)},Y=J.extend({options:{fill:!0},initialize:function(e,i,t){J.prototype.initialize.call(this,e,i,t)},_updatePath:function(){this._renderer._updateSquareMarker(this)},_svgCanvasIncludes:function(){i.Canvas.include({_updateSquareMarker:function(e){var i=e._point,t=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(i.x+t,i.y+t),r.lineTo(i.x-t,i.y+t),r.lineTo(i.x-t,i.y-t),r.lineTo(i.x+t,i.y-t),r.closePath(),this._fillStroke(r,e)}}),i.SVG.include({_updateSquareMarker:function(e){var t=e._point,r=e._size/2;i.Browser.vml&&(t._round(),r=Math.round(r));var s="M"+(t.x+r)+","+(t.y+r)+"L"+(t.x-r)+","+(t.y+r)+"L"+(t.x-r)+","+(t.y-r)+"L"+(t.x+r)+","+(t.y-r);s+=i.Browser.svg?"z":"x",this._setPath(e,s)}})}}),E=function(e,i,t){return new Y(e,i,t)},H=J.extend({options:{fill:!0},initialize:function(e,i,t){J.prototype.initialize.call(this,e,i,t)},_updatePath:function(){this._renderer._updateDiamondMarker(this)},_svgCanvasIncludes:function(){i.Canvas.include({_updateDiamondMarker:function(e){var i=e._point,t=e._size/2,r=this._ctx;r.beginPath(),r.moveTo(i.x,i.y+t),r.lineTo(i.x-t,i.y),r.lineTo(i.x,i.y-t),r.lineTo(i.x+t,i.y),r.closePath(),this._fillStroke(r,e)}}),i.SVG.include({_updateDiamondMarker:function(e){var t=e._point,r=e._size/2;i.Browser.vml&&(t._round(),r=Math.round(r));var s="M"+t.x+","+(t.y+r)+"L"+(t.x-r)+","+t.y+"L"+t.x+","+(t.y-r)+"L"+(t.x+r)+","+t.y;s+=i.Browser.svg?"z":"x",this._setPath(e,s)}})}}),B=function(e,i,t){return new H(e,i,t)},R=P.extend({statics:{MARKERTYPES:["esriSMSCircle","esriSMSCross","esriSMSDiamond","esriSMSSquare","esriSMSX","esriPMS"]},initialize:function(e,i){var t;if(P.prototype.initialize.call(this,e,i),i&&(this.serviceUrl=i.url),e)if("esriPMS"===e.type){var r=this._symbolJson.url;r&&"http://"===r.substr(0,7)||"https://"===r.substr(0,8)?(t=this.sanitize(r),this._iconUrl=t):(t=this.serviceUrl+"images/"+r,this._iconUrl=i&&i.token?t+"?token="+i.token:t),e.imageData&&(this._iconUrl="data:"+e.contentType+";base64,"+e.imageData),this._icons={},this.icon=this._createIcon(this._symbolJson)}else this._fillStyles()},sanitize:function(e){if(!e)return"";var i;try{i=e.replace(/<br>/gi,"\n"),i=i.replace(/<p.*>/gi,"\n"),i=i.replace(/<a.*href='(.*?)'.*>(.*?)<\/a>/gi," $2 ($1) "),i=i.replace(/<(?:.|\s)*?>/g,"")}catch(e){i=null}return i},_fillStyles:function(){this._symbolJson.outline&&this._symbolJson.size>0&&"esriSLSNull"!==this._symbolJson.outline.style?(this._styles.stroke=!0,this._styles.weight=this.pixelValue(this._symbolJson.outline.width),this._styles.color=this.colorValue(this._symbolJson.outline.color),this._styles.opacity=this.alphaValue(this._symbolJson.outline.color)):this._styles.stroke=!1,this._symbolJson.color?(this._styles.fillColor=this.colorValue(this._symbolJson.color),this._styles.fillOpacity=this.alphaValue(this._symbolJson.color)):this._styles.fillOpacity=0,"esriSMSCircle"===this._symbolJson.style&&(this._styles.radius=this.pixelValue(this._symbolJson.size)/2)},_createIcon:function(e){var t=this.pixelValue(e.width),r=t;e.height&&(r=this.pixelValue(e.height));var s=t/2,n=r/2;e.xoffset&&(s+=this.pixelValue(e.xoffset)),e.yoffset&&(n+=this.pixelValue(e.yoffset));var o=i.icon({iconUrl:this._iconUrl,iconSize:[t,r],iconAnchor:[s,n]});return this._icons[e.width.toString()]=o,o},_getIcon:function(e){var i=this._icons[e.toString()];return i||(i=this._createIcon({width:e})),i},pointToLayer:function(e,t,r,s){var n=this._symbolJson.size||this._symbolJson.width;if(!this._isDefault){if(r.sizeInfo){var o=this.getSize(e,r.sizeInfo);o&&(n=o)}if(r.colorInfo){var a=this.getColor(e,r.colorInfo);a&&(this._styles.fillColor=this.colorValue(a),this._styles.fillOpacity=this.alphaValue(a))}}if("esriPMS"===this._symbolJson.type){var l=i.extend({},{icon:this._getIcon(n)},s);return i.marker(t,l)}switch(n=this.pixelValue(n),this._symbolJson.style){case"esriSMSSquare":return E(t,n,i.extend({},this._styles,s));case"esriSMSDiamond":return B(t,n,i.extend({},this._styles,s));case"esriSMSCross":return F(t,n,i.extend({},this._styles,s));case"esriSMSX":return G(t,n,i.extend({},this._styles,s))}return this._styles.radius=n/2,i.circleMarker(t,i.extend({},this._styles,s))}}),A=P.extend({statics:{LINETYPES:["esriSLSDash","esriSLSDot","esriSLSDashDotDot","esriSLSDashDot","esriSLSSolid"]},initialize:function(e,i){P.prototype.initialize.call(this,e,i),this._fillStyles()},_fillStyles:function(){if(this._styles.lineCap="butt",this._styles.lineJoin="miter",this._styles.fill=!1,this._styles.weight=0,!this._symbolJson)return this._styles;if(this._symbolJson.color&&(this._styles.color=this.colorValue(this._symbolJson.color),this._styles.opacity=this.alphaValue(this._symbolJson.color)),!isNaN(this._symbolJson.width)){this._styles.weight=this.pixelValue(this._symbolJson.width);var e=[];switch(this._symbolJson.style){case"esriSLSDash":e=[4,3];break;case"esriSLSDot":e=[1,3];break;case"esriSLSDashDot":e=[8,3,1,3];break;case"esriSLSDashDotDot":e=[8,3,1,3,1,3]}if(e.length>0){for(var i=0;i<e.length;i++)e[i]*=this._styles.weight;this._styles.dashArray=e.join(",")}}},style:function(e,i){if(!this._isDefault&&i){if(i.sizeInfo){var t=this.pixelValue(this.getSize(e,i.sizeInfo));t&&(this._styles.weight=t)}if(i.colorInfo){var r=this.getColor(e,i.colorInfo);r&&(this._styles.color=this.colorValue(r),this._styles.opacity=this.alphaValue(r))}}return this._styles}}),U=P.extend({statics:{POLYGONTYPES:["esriSFSSolid"]},initialize:function(e,i){P.prototype.initialize.call(this,e,i),e&&(e.outline&&"esriSLSNull"===e.outline.style?this._lineStyles={weight:0}:this._lineStyles=h(e.outline,i).style(),this._fillStyles())},_fillStyles:function(){if(this._lineStyles)if(0===this._lineStyles.weight)this._styles.stroke=!1;else for(var e in this._lineStyles)this._styles[e]=this._lineStyles[e];this._symbolJson&&(this._symbolJson.color&&U.POLYGONTYPES.indexOf(this._symbolJson.style>=0)?(this._styles.fill=!0,this._styles.fillColor=this.colorValue(this._symbolJson.color),this._styles.fillOpacity=this.alphaValue(this._symbolJson.color)):(this._styles.fill=!1,this._styles.fillOpacity=0))},style:function(e,i){if(!this._isDefault&&i&&i.colorInfo){var t=this.getColor(e,i.colorInfo);t&&(this._styles.fillColor=this.colorValue(t),this._styles.fillOpacity=this.alphaValue(t))}return this._styles}}),Q=i.Class.extend({options:{proportionalPolygon:!1,clickable:!0},initialize:function(e,t){this._rendererJson=e,this._pointSymbols=!1,this._symbols=[],this._visualVariables=this._parseVisualVariables(e.visualVariables),i.Util.setOptions(this,t)},_parseVisualVariables:function(e){var i={};if(e)for(var t=0;t<e.length;t++)i[e[t].type]=e[t];return i},_createDefaultSymbol:function(){this._rendererJson.defaultSymbol&&(this._defaultSymbol=this._newSymbol(this._rendererJson.defaultSymbol),this._defaultSymbol._isDefault=!0)},_newSymbol:function(e){return"esriSMS"===e.type||"esriPMS"===e.type?(this._pointSymbols=!0,y(e,this.options)):"esriSLS"===e.type?h(e,this.options):"esriSFS"===e.type?c(e,this.options):void 0},_getSymbol:function(){},attachStylesToLayer:function(e){this._pointSymbols?e.options.pointToLayer=i.Util.bind(this.pointToLayer,this):(e.options.style=i.Util.bind(this.style,this),e._originalStyle=e.options.style)},pointToLayer:function(e,t){var r=this._getSymbol(e);return r&&r.pointToLayer?r.pointToLayer(e,t,this._visualVariables,this.options):i.circleMarker(t,{radius:0,opacity:0})},style:function(e){var i;this.options.userDefinedStyle&&(i=this.options.userDefinedStyle(e));var t=this._getSymbol(e);return t?this.mergeStyles(t.style(e,this._visualVariables),i):this.mergeStyles({opacity:0,fillOpacity:0},i)},mergeStyles:function(e,i){var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);if(i)for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t]);return r}}),K=Q.extend({initialize:function(e,i){Q.prototype.initialize.call(this,e,i),this._field=this._rendererJson.field,this._rendererJson.normalizationType&&"esriNormalizeByField"===this._rendererJson.normalizationType&&(this._normalizationField=this._rendererJson.normalizationField),this._createSymbols()},_createSymbols:function(){var e,i=this._rendererJson.classBreakInfos;this._symbols=[];for(var t=i.length-1;t>=0;t--)e=this.options.proportionalPolygon&&this._rendererJson.backgroundFillSymbol?this._newSymbol(this._rendererJson.backgroundFillSymbol):this._newSymbol(i[t].symbol),e.val=i[t].classMaxValue,this._symbols.push(e);this._symbols.sort(function(e,i){return e.val>i.val?1:-1}),this._createDefaultSymbol(),this._maxValue=this._symbols[this._symbols.length-1].val},_getSymbol:function(e){var i=e.properties[this._field];if(this._normalizationField){var t=e.properties[this._normalizationField];if(isNaN(t)||0===t)return this._defaultSymbol;i/=t}if(i>this._maxValue)return this._defaultSymbol;for(var r=this._symbols[0],s=this._symbols.length-1;s>=0&&!(i>this._symbols[s].val);s--)r=this._symbols[s];return r}}),X=Q.extend({initialize:function(e,i){Q.prototype.initialize.call(this,e,i),this._field=this._rendererJson.field1,this._createSymbols()},_createSymbols:function(){for(var e,i=this._rendererJson.uniqueValueInfos,t=i.length-1;t>=0;t--)e=this._newSymbol(i[t].symbol),e.val=i[t].value,this._symbols.push(e);this._createDefaultSymbol()},_getSymbol:function(e){var i=e.properties[this._field];if(this._rendererJson.fieldDelimiter&&this._rendererJson.field2){var t=e.properties[this._rendererJson.field2];if(t){i+=this._rendererJson.fieldDelimiter+t;var r=e.properties[this._rendererJson.field3];r&&(i+=this._rendererJson.fieldDelimiter+r)}}for(var s=this._defaultSymbol,n=this._symbols.length-1;n>=0;n--)this._symbols[n].val==i&&(s=this._symbols[n]);return s}}),$=Q.extend({initialize:function(e,i){Q.prototype.initialize.call(this,e,i),this._createSymbol()},_createSymbol:function(){this._rendererJson.symbol&&this._symbols.push(this._newSymbol(this._rendererJson.symbol))},_getSymbol:function(){return this._symbols[0]}}),Z=i.GeoJSON.extend({options:{data:{},opacity:1},initialize:function(e,t){i.setOptions(this,t),this.data=this.options.data,this.opacity=this.options.opacity,this.popupInfo=null,this.labelingInfo=null,this._layers={};var r,s;if(e)for(r=0,s=e.length;r<s;r++)this.addLayer(e[r]);"string"==typeof this.data?this._getFeatureCollection(this.data):this._parseFeatureCollection(this.data)},_getFeatureCollection:function(e){var t="https://www.arcgis.com/sharing/rest/content/items/"+e+"/data";i.esri.request(t,{},function(e,i){e?console.log(e):this._parseFeatureCollection(i)},this)},_parseFeatureCollection:function(e){var i,t,r=0;for(i=0,t=e.layers.length;i<t;i++)e.layers[i].featureSet.features.length>0&&(r=i);var s=e.layers[r].featureSet.features,n=e.layers[r].layerDefinition.geometryType,o=e.layers[r].layerDefinition.objectIdField,a=e.layers[r].layerDefinition||null;4326!==e.layers[r].layerDefinition.extent.spatialReference.wkid&&(102100!==e.layers[r].layerDefinition.extent.spatialReference.wkid&&console.error("[L.esri.WebMap] this wkid ("+e.layers[r].layerDefinition.extent.spatialReference.wkid+") is not supported."),s=this._projTo4326(s,n)),void 0!==e.layers[r].popupInfo&&(this.popupInfo=e.layers[r].popupInfo),void 0!==e.layers[r].layerDefinition.drawingInfo.labelingInfo&&(this.labelingInfo=e.layers[r].layerDefinition.drawingInfo.labelingInfo),console.log(e);var l=this._featureCollectionToGeoJSON(s,o);null!==a&&x(a,this),console.log(l),this.addData(l)},_projTo4326:function(e,t){console.log("_project!");var r,s,n=[];for(r=0,s=e.length;r<s;r++){var o,a,l,u=e[r];if("esriGeometryPoint"===t)o=i.Projection.SphericalMercator.unproject(i.point(u.geometry.x,u.geometry.y)),u.geometry.x=o.lng,u.geometry.y=o.lat;else if("esriGeometryMultipoint"===t){var f;for(a=0,f=u.geometry.points.length;a<f;a++)o=i.Projection.SphericalMercator.unproject(i.point(u.geometry.points[a][0],u.geometry.points[a][1])),u.geometry.points[a][0]=o.lng,u.geometry.points[a][1]=o.lat}else if("esriGeometryPolyline"===t){var d,p;for(a=0,p=u.geometry.paths.length;a<p;a++)for(l=0,d=u.geometry.paths[a].length;l<d;l++)o=i.Projection.SphericalMercator.unproject(i.point(u.geometry.paths[a][l][0],u.geometry.paths[a][l][1])),u.geometry.paths[a][l][0]=o.lng,u.geometry.paths[a][l][1]=o.lat}else if("esriGeometryPolygon"===t){var y,h;for(a=0,h=u.geometry.rings.length;a<h;a++)for(l=0,y=u.geometry.rings[a].length;l<y;l++)o=i.Projection.SphericalMercator.unproject(i.point(u.geometry.rings[a][l][0],u.geometry.rings[a][l][1])),u.geometry.rings[a][l][0]=o.lng,u.geometry.rings[a][l][1]=o.lat}n.push(u)}return n},_featureCollectionToGeoJSON:function(e,i){var t,r,s={type:"FeatureCollection",features:[]},n=[];for(t=0,r=e.length;t<r;t++){var o=p(e[t],i);n.push(o)}return s.features=n,s}}),ee=i.GeoJSON.extend({options:{url:"",data:{},opacity:1},initialize:function(e,t){i.setOptions(this,t),this.url=this.options.url,this.layerDefinition=this.options.layerDefinition,this.locationInfo=this.options.locationInfo,this.opacity=this.options.opacity,this._layers={};var r,s;if(e)for(r=0,s=e.length;r<s;r++)this.addLayer(e[r]);this._parseCSV(this.url,this.layerDefinition,this.locationInfo)},_parseCSV:function(e,i,r){t.csv(e,{latfield:r.latitudeFieldName,lonfield:r.longitudeFieldName},this),x(i,this)}}),ie=i.GeoJSON.extend({options:{opacity:1,url:""},initialize:function(e,t){i.setOptions(this,t),this.url=this.options.url,this.opacity=this.options.opacity,this.popupInfo=null,this.labelingInfo=null,this._layers={};var r,s;if(e)for(r=0,s=e.length;r<s;r++)this.addLayer(e[r]);this._getKML(this.url)},_getKML:function(e){var t="http://utility.arcgis.com/sharing/kml?url="+e+'&model=simple&folders=&outSR=%7B"wkid"%3A4326%7D';i.esri.request(t,{},function(e,i){e?console.log(e):(console.log(i),this._parseFeatureCollection(i.featureCollection))},this)},_parseFeatureCollection:function(e){console.log("_parseFeatureCollection");var i;for(i=0;i<3;i++)if(e.layers[i].featureSet.features.length>0){console.log(i);var t=e.layers[i].featureSet.features,r=e.layers[i].layerDefinition.objectIdField,s=this._featureCollectionToGeoJSON(t,r);void 0!==e.layers[i].popupInfo&&(this.popupInfo=e.layers[i].popupInfo),void 0!==e.layers[i].layerDefinition.drawingInfo.labelingInfo&&(this.labelingInfo=e.layers[i].layerDefinition.drawingInfo.labelingInfo),x(e.layers[i].layerDefinition,this),console.log(s),this.addData(s)}},_featureCollectionToGeoJSON:function(e,i){var t,r,s={type:"FeatureCollection",features:[]},n=[];for(t=0,r=e.length;t<r;t++){var o=p(e[t],i);n.push(o)}return s.features=n,s}}),te=i.DivIcon.extend({options:{iconSize:null,className:"esri-leaflet-webmap-labels",text:""},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),r=this.options
;if(t.innerHTML='<div style="position: relative; left: -50%; text-shadow: 1px 1px 0px #fff, -1px 1px 0px #fff, 1px -1px 0px #fff, -1px -1px 0px #fff;">'+r.text+"</div>",t.style.fontSize="1em",t.style.fontWeight="bold",t.style.textTransform="uppercase",t.style.textAlign="center",t.style.whiteSpace="nowrap",r.bgPos){var s=i.point(r.bgPos);t.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(t,"icon"),t}}),re=i.Marker.extend({options:{properties:{},labelingInfo:{},offset:[0,0]},initialize:function(e,t){i.setOptions(this,t),this._latlng=i.latLng(e);var r=this._createLabelText(this.options.properties,this.options.labelingInfo);this._setLabelIcon(r,this.options.offset)},_createLabelText:function(e,i){var t=/\[([^\]]*)\]/g,r=i[0].labelExpression;return r=r.replace(t,function(i){var r=t.exec(i);return e[r[1]]})},_setLabelIcon:function(e,i){var t=q({text:e,iconAnchor:i});this.setIcon(t)}});module.exports={addDays:require("./add_days/index.js"),addHours:require("./add_hours/index.js"),addISOYears:require("./add_iso_years/index.js"),addMilliseconds:require("./add_milliseconds/index.js"),addMinutes:require("./add_minutes/index.js"),addMonths:require("./add_months/index.js"),addQuarters:require("./add_quarters/index.js"),addSeconds:require("./add_seconds/index.js"),addWeeks:require("./add_weeks/index.js"),addYears:require("./add_years/index.js"),areRangesOverlapping:require("./are_ranges_overlapping/index.js"),closestIndexTo:require("./closest_index_to/index.js"),closestTo:require("./closest_to/index.js"),compareAsc:require("./compare_asc/index.js"),compareDesc:require("./compare_desc/index.js"),differenceInCalendarDays:require("./difference_in_calendar_days/index.js"),differenceInCalendarISOWeeks:require("./difference_in_calendar_iso_weeks/index.js"),differenceInCalendarISOYears:require("./difference_in_calendar_iso_years/index.js"),differenceInCalendarMonths:require("./difference_in_calendar_months/index.js"),differenceInCalendarQuarters:require("./difference_in_calendar_quarters/index.js"),differenceInCalendarWeeks:require("./difference_in_calendar_weeks/index.js"),differenceInCalendarYears:require("./difference_in_calendar_years/index.js"),differenceInDays:require("./difference_in_days/index.js"),differenceInHours:require("./difference_in_hours/index.js"),differenceInISOYears:require("./difference_in_iso_years/index.js"),differenceInMilliseconds:require("./difference_in_milliseconds/index.js"),differenceInMinutes:require("./difference_in_minutes/index.js"),differenceInMonths:require("./difference_in_months/index.js"),differenceInQuarters:require("./difference_in_quarters/index.js"),differenceInSeconds:require("./difference_in_seconds/index.js"),differenceInWeeks:require("./difference_in_weeks/index.js"),differenceInYears:require("./difference_in_years/index.js"),distanceInWords:require("./distance_in_words/index.js"),distanceInWordsStrict:require("./distance_in_words_strict/index.js"),distanceInWordsToNow:require("./distance_in_words_to_now/index.js"),eachDay:require("./each_day/index.js"),endOfDay:require("./end_of_day/index.js"),endOfHour:require("./end_of_hour/index.js"),endOfISOWeek:require("./end_of_iso_week/index.js"),endOfISOYear:require("./end_of_iso_year/index.js"),endOfMinute:require("./end_of_minute/index.js"),endOfMonth:require("./end_of_month/index.js"),endOfQuarter:require("./end_of_quarter/index.js"),endOfSecond:require("./end_of_second/index.js"),endOfToday:require("./end_of_today/index.js"),endOfTomorrow:require("./end_of_tomorrow/index.js"),endOfWeek:require("./end_of_week/index.js"),endOfYear:require("./end_of_year/index.js"),endOfYesterday:require("./end_of_yesterday/index.js"),format:require("./format/index.js"),getDate:require("./get_date/index.js"),getDay:require("./get_day/index.js"),getDayOfYear:require("./get_day_of_year/index.js"),getDaysInMonth:require("./get_days_in_month/index.js"),getDaysInYear:require("./get_days_in_year/index.js"),getHours:require("./get_hours/index.js"),getISODay:require("./get_iso_day/index.js"),getISOWeek:require("./get_iso_week/index.js"),getISOWeeksInYear:require("./get_iso_weeks_in_year/index.js"),getISOYear:require("./get_iso_year/index.js"),getMilliseconds:require("./get_milliseconds/index.js"),getMinutes:require("./get_minutes/index.js"),getMonth:require("./get_month/index.js"),getOverlappingDaysInRanges:require("./get_overlapping_days_in_ranges/index.js"),getQuarter:require("./get_quarter/index.js"),getSeconds:require("./get_seconds/index.js"),getTime:require("./get_time/index.js"),getYear:require("./get_year/index.js"),isAfter:require("./is_after/index.js"),isBefore:require("./is_before/index.js"),isDate:require("./is_date/index.js"),isEqual:require("./is_equal/index.js"),isFirstDayOfMonth:require("./is_first_day_of_month/index.js"),isFriday:require("./is_friday/index.js"),isFuture:require("./is_future/index.js"),isLastDayOfMonth:require("./is_last_day_of_month/index.js"),isLeapYear:require("./is_leap_year/index.js"),isMonday:require("./is_monday/index.js"),isPast:require("./is_past/index.js"),isSameDay:require("./is_same_day/index.js"),isSameHour:require("./is_same_hour/index.js"),isSameISOWeek:require("./is_same_iso_week/index.js"),isSameISOYear:require("./is_same_iso_year/index.js"),isSameMinute:require("./is_same_minute/index.js"),isSameMonth:require("./is_same_month/index.js"),isSameQuarter:require("./is_same_quarter/index.js"),isSameSecond:require("./is_same_second/index.js"),isSameWeek:require("./is_same_week/index.js"),isSameYear:require("./is_same_year/index.js"),isSaturday:require("./is_saturday/index.js"),isSunday:require("./is_sunday/index.js"),isThisHour:require("./is_this_hour/index.js"),isThisISOWeek:require("./is_this_iso_week/index.js"),isThisISOYear:require("./is_this_iso_year/index.js"),isThisMinute:require("./is_this_minute/index.js"),isThisMonth:require("./is_this_month/index.js"),isThisQuarter:require("./is_this_quarter/index.js"),isThisSecond:require("./is_this_second/index.js"),isThisWeek:require("./is_this_week/index.js"),isThisYear:require("./is_this_year/index.js"),isThursday:require("./is_thursday/index.js"),isToday:require("./is_today/index.js"),isTomorrow:require("./is_tomorrow/index.js"),isTuesday:require("./is_tuesday/index.js"),isValid:require("./is_valid/index.js"),isWednesday:require("./is_wednesday/index.js"),isWeekend:require("./is_weekend/index.js"),isWithinRange:require("./is_within_range/index.js"),isYesterday:require("./is_yesterday/index.js"),lastDayOfISOWeek:require("./last_day_of_iso_week/index.js"),lastDayOfISOYear:require("./last_day_of_iso_year/index.js"),lastDayOfMonth:require("./last_day_of_month/index.js"),lastDayOfQuarter:require("./last_day_of_quarter/index.js"),lastDayOfWeek:require("./last_day_of_week/index.js"),lastDayOfYear:require("./last_day_of_year/index.js"),max:require("./max/index.js"),min:require("./min/index.js"),parse:require("./parse/index.js"),setDate:require("./set_date/index.js"),setDay:require("./set_day/index.js"),setDayOfYear:require("./set_day_of_year/index.js"),setHours:require("./set_hours/index.js"),setISODay:require("./set_iso_day/index.js"),setISOWeek:require("./set_iso_week/index.js"),setISOYear:require("./set_iso_year/index.js"),setMilliseconds:require("./set_milliseconds/index.js"),setMinutes:require("./set_minutes/index.js"),setMonth:require("./set_month/index.js"),setQuarter:require("./set_quarter/index.js"),setSeconds:require("./set_seconds/index.js"),setYear:require("./set_year/index.js"),startOfDay:require("./start_of_day/index.js"),startOfHour:require("./start_of_hour/index.js"),startOfISOWeek:require("./start_of_iso_week/index.js"),startOfISOYear:require("./start_of_iso_year/index.js"),startOfMinute:require("./start_of_minute/index.js"),startOfMonth:require("./start_of_month/index.js"),startOfQuarter:require("./start_of_quarter/index.js"),startOfSecond:require("./start_of_second/index.js"),startOfToday:require("./start_of_today/index.js"),startOfTomorrow:require("./start_of_tomorrow/index.js"),startOfWeek:require("./start_of_week/index.js"),startOfYear:require("./start_of_year/index.js"),startOfYesterday:require("./start_of_yesterday/index.js"),subDays:require("./sub_days/index.js"),subHours:require("./sub_hours/index.js"),subISOYears:require("./sub_iso_years/index.js"),subMilliseconds:require("./sub_milliseconds/index.js"),subMinutes:require("./sub_minutes/index.js"),subMonths:require("./sub_months/index.js"),subQuarters:require("./sub_quarters/index.js"),subSeconds:require("./sub_seconds/index.js"),subWeeks:require("./sub_weeks/index.js"),subYears:require("./sub_years/index.js")};var se=i.Evented.extend({options:{map:{},token:null,server:"www.arcgis.com"},initialize:function(e,t){i.setOptions(this,t),this._map=this.options.map,this._token=this.options.token,this._server=this.options.server,this._webmapId=e,this._loaded=!1,this._metadataLoaded=!1,this._loadedLayersNum=0,this._layersNum=0,this.layers=[],this.title="",this.bookmarks=[],this.portalItem={},this.VERSION="0.4.0",this._loadWebMapMetaData(e),this._loadWebMap(e)},_checkLoaded:function(){++this._loadedLayersNum===this._layersNum&&(this._loaded=!0,this.fire("load"))},_operationalLayer:function(e,i,t,r,s){var n=T(e,i,t,r,s);void 0!==n&&!0===e.visibility&&n.addTo(t)},_loadWebMapMetaData:function(e){var t={},r=this._map,s=this,n="https://"+this._server+"/sharing/rest/content/items/"+e;this._token&&this._token.length>0&&(t.token=this._token),i.esri.request(n,t,function(e,i){e?console.log(e):(s.portalItem=i,s.title=i.title,s._metadataLoaded=!0,s.fire("metadataLoad"),r.fitBounds([i.extent[0].reverse(),i.extent[1].reverse()]))})},_loadWebMap:function(e){var t=this._map,r=this.layers,s=this._server,n={},o="https://"+s+"/sharing/rest/content/items/"+e+"/data";this._token&&this._token.length>0&&(n.token=this._token),i.esri.request(o,n,function(e,o){e?console.log("L.esri.request error:",e):(this._layersNum=o.baseMap.baseMapLayers.length+o.operationalLayers.length,o.baseMap.baseMapLayers.map(function(o){if(void 0!==o.itemId){var a="https://"+s+"/sharing/rest/content/items/"+o.itemId;i.esri.request(a,n,function(i,s){i?console.error(e):(console.log(s.access),"public"!==s.access?this._operationalLayer(o,r,t,n):this._operationalLayer(o,r,t,{})),this._checkLoaded()},this)}else this._operationalLayer(o,r,t,{}),this._checkLoaded()}.bind(this)),o.operationalLayers.map(function(o,a){var l="esri-webmap-layer"+a;if(t.createPane(l),void 0!==o.itemId){var u="https://"+s+"/sharing/rest/content/items/"+o.itemId;i.esri.request(u,n,function(i,s){i?console.error(e):(console.log(s.access),"public"!==s.access?this._operationalLayer(o,r,t,n,l):this._operationalLayer(o,r,t,{},l)),this._checkLoaded()},this)}else this._operationalLayer(o,r,t,{},l),this._checkLoaded()}.bind(this)),void 0!==o.bookmarks&&o.bookmarks.length>0&&o.bookmarks.map(function(e){var t=i.Projection.SphericalMercator.unproject(i.point(e.extent.xmax,e.extent.ymax)),r=i.Projection.SphericalMercator.unproject(i.point(e.extent.xmin,e.extent.ymin)),s=i.latLngBounds(r,t);this.bookmarks.push({name:e.name,bounds:s})}.bind(this)))}.bind(this))}});e.WebMap=se,e.webMap=z,e.operationalLayer=T,e.FeatureCollection=Z,e.featureCollection=S,e.LabelMarker=re,e.labelMarker=j,e.LabelIcon=te,e.labelIcon=q,e.createPopupContent=O,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=esri-leaflet-webmap.js.map