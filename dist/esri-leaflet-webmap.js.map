{"version":3,"file":null,"sources":["../src/Popup/Popup.js","../src/Label/Label.js","../src/OperationalLayer.js","../src/WebMapLoader.js"],"sourcesContent":["export function createPopupContent (popupInfo, properties) {\n    //console.log(popupInfo, properties);\n    var r = /\\{([^\\]]*)\\}/g;\n    var titleText = '';\n    var content = '';\n\n    if (popupInfo.title !== undefined) {\n        titleText = popupInfo.title;\n    }\n\n    titleText = titleText.replace(r, function(s) {\n        var m = r.exec(s);\n        return properties[m[1]];\n    });\n\n    content = '<div class=\"leaflet-popup-content-title\"><h4>' + titleText + '</h4></div><div class=\"leaflet-popup-content-description\" style=\"max-height:200px;overflow:auto;\">';\n    \n    for (var i = 0; i < popupInfo.fieldInfos.length; i++) {\n        if (popupInfo.fieldInfos[i].visible === true) {\n            content += '<div style=\"font-weight:bold;color:#999;margin-top:5px;word-break:break-all;\">' + popupInfo.fieldInfos[i].label + '</div><p style=\"margin-top:0;margin-bottom:5px;word-break:break-all;\">' + properties[popupInfo.fieldInfos[i].fieldName] + '</p>';\n        }\n    }\n\n    content += '</div>';\n\n    if (popupInfo.mediaInfos.length > 0) {\n        // It does not support mediaInfos for popup contents.\n    }\n\n    return content;\n}\n\nexport var Popup = {\n  createPopupContent: createPopupContent\n};\n\nexport default Popup;","export function createLabelText (properties, labelingInfo) {\n    //console.log('generateLabels: ', properties, labelingInfo);\n    var r = /\\[([^\\]]*)\\]/g;\n    var labelText = labelingInfo[0].labelExpression;\n\n    labelText = labelText.replace(r, function(s) {\n        var m = r.exec(s);\n        //console.log(m[1]);\n        //console.log(properties[m[1]]);\n        return properties[m[1]];\n    });\n\n    return labelText;\n}\n\nexport var Label = {\n  createLabelText: createLabelText\n};\n\nexport default Label;","import L from 'leaflet';\nimport { createPopupContent } from './Popup/Popup';\nimport { createLabelText } from './Label/Label';\n\nexport function operationalLayer (layer, layers, map) {\n  return _generateEsriLayer(layer, layers, map);\n}\n\nexport function _generateEsriLayer (layer, layers, map) {\n    console.log('generateEsriLayer: ', layer.title, layer);\n\n    if(layer.featureCollection !== undefined) {\n        // Supporting only point geometry\n        console.log('create FeatureCollection');\n        var renderer = layer.featureCollection.layers[0].layerDefinition.drawingInfo.renderer;\n        //console.log(renderer);\n        var features = [];\n        var labels = [];\n\n        layer.featureCollection.layers[0].featureSet.features.map(function(feature) {\n\n            var icon = _generateIcon(renderer, feature.attributes);\n            var mercatorToLatlng = L.Projection.SphericalMercator.unproject(L.point(feature.geometry.x, feature.geometry.y));\n\n            var f = L.marker(mercatorToLatlng, { icon: icon, opacity: layer.opacity });\n\n            if(layer.featureCollection.layers[0].popupInfo !== undefined) {\n                var popupContent = createPopupContent(layer.featureCollection.layers[0].popupInfo, feature.attributes);\n                f.bindPopup(popupContent);\n            }\n\n            if(layer.featureCollection.layers[0].layerDefinition.drawingInfo.labelingInfo !== undefined) {\n                var labelingInfo = layer.featureCollection.layers[0].layerDefinition.drawingInfo.labelingInfo;\n                var labelText = createLabelText(feature.attributes, labelingInfo);\n                    // with Leaflet.label\n                    //f.bindLabel(labelText, { noHide: true }).showLabel();\n\n                    // without Leaflet.label\n                    var label = L.marker(mercatorToLatlng, {\n                        zIndexOffset: 1,\n                    icon: L.divIcon({\n                    iconSize: null,\n                    className: 'point-label',\n                    html: '<div>' + labelText + '</div>'\n                    })\n                });\n\n                labels.push(label);\n            }\n\n            features.push(f);\n        });\n\n        var lyr = L.featureGroup(features);\n\n        if(labels.length > 0) {\n            var labelsLayer = L.featureGroup(labels);\n            lyr = L.layerGroup([lyr, labelsLayer]);\n        }\n\n        layers.push({ type: 'FC', title: layer.title || '', layer: lyr });\n\n        return lyr;\n    }\n    else if(layer.layerType === 'ArcGISFeatureLayer' && layer.layerDefinition !== undefined) {\n        if(layer.layerDefinition.drawingInfo !== undefined){\n            if(layer.layerDefinition.drawingInfo.renderer.type === 'heatmap'){\n                console.log('create HeatmapLayer');\n                var gradient = {};\n\n                layer.layerDefinition.drawingInfo.renderer.colorStops.map(function(stop) {\n                    //gradient[stop.ratio] = 'rgba(' + stop.color[0] + ',' + stop.color[1] + ',' + stop.color[2] + ',' + (stop.color[3]/255) + ')';\n                    //gradient[Math.round(stop.ratio*100)/100] = 'rgb(' + stop.color[0] + ',' + stop.color[1] + ',' + stop.color[2] + ')';\n                    gradient[(Math.round(stop.ratio*100)/100+6)/7] = 'rgb(' + stop.color[0] + ',' + stop.color[1] + ',' + stop.color[2] + ')';\n                });\n                //console.log(layer.layerDefinition.drawingInfo.renderer);\n\n                var lyr = L.esri.Heat.heatmapFeatureLayer({ // Esri Leaflet 2.0\n                //var lyr = L.esri.heatmapFeatureLayer({ // Esri Leaflet 1.0\n                    url: layer.url,\n                    minOpacity: 0.5,\n                    max: layer.layerDefinition.drawingInfo.renderer.maxPixelIntensity,\n                    blur: layer.layerDefinition.drawingInfo.renderer.blurRadius,\n                    radius: layer.layerDefinition.drawingInfo.renderer.blurRadius * 1.3,\n                    gradient: gradient\n                })\n                layers.push({ type: 'HL', title: layer.title || '', layer: lyr });\n\n                return lyr;\n            }\n            else {\n                console.log('create ArcGISFeatureLayer (with layerDefinition.drawingInfo)');\n                var renderer = layer.layerDefinition.drawingInfo.renderer;\n                var where = '1=1';\n\n                if(layer.layerDefinition.definitionExpression !== undefined) {\n                    where = layer.layerDefinition.definitionExpression;\n                }\n\n                var labels = [];\n                var labelsLayer = L.featureGroup(labels);\n                var lyr = L.esri.featureLayer({\n                    url: layer.url,\n                    where: where,\n                    ignoreRenderer: true,\n                    pointToLayer: function (geojson, latlng) {\n                        //console.log(geojson);\n                        var icon = _generateIcon(renderer, geojson.properties);\n\n                        var f = L.marker(latlng, {\n                            icon: icon,\n                            opacity: layer.opacity\n                        });\n\n                        return f;\n                    },\n                    style: function (geojson) {\n                        var pathOptions;\n                        //console.log(geojson);\n                        if(geojson.geometry.type === 'LineString' || geojson.geometry.type === 'MultiLineString' || geojson.geometry.type === 'Polygon' || geojson.geometry.type === 'MultiPolygon') {\n                            pathOptions = _generatePathStyle(renderer, geojson.properties);\n                        }\n                        else {\n                            //console.log(geojson);\n                        }\n\n                        return pathOptions;\n                    },\n                    onEachFeature: function (geojson, l) {\n                        if(layer.popupInfo !== undefined) {\n                            var popupContent = createPopupContent(layer.popupInfo, geojson.properties);\n                            l.bindPopup(popupContent);\n                        }\n                        if(layer.layerDefinition.drawingInfo.labelingInfo !== undefined) {\n                            var labelingInfo = layer.layerDefinition.drawingInfo.labelingInfo;\n                            var labelText = createLabelText(geojson.properties, labelingInfo);\n                            //console.log(labelText);\n                            // with Leaflet.label\n                            //f.bindLabel(labelText, { noHide: true }).showLabel();\n\n                            //console.log(geojson);\n                            //console.log(l);\n                            var labelPos;\n                            var labelClassName;\n                            if(l.feature.geometry.type === 'Point') {\n                                labelPos = l.feature.geometry.coordinates.reverse();\n                                labelClassName = 'point-label';\n                            }\n                            else if(l.feature.geometry.type === 'LineString') {\n                                //console.log(l.feature.geometry.coordinates);\n                                var c = l.feature.geometry.coordinates;\n                                var centralKey = Math.round(c.length/2);\n                                //console.log(c[centralKey]);\n                                labelPos = c[centralKey].reverse();\n                                labelClassName = 'path-label';\n                            }\n                            else if(l.feature.geometry.type === 'MultiLineString') {\n                                //.log(l.feature.geometry.coordinates);\n                                var c = l.feature.geometry.coordinates;\n                                var centralKey = Math.round(c.length/2);\n                                var c2 = c[centralKey];\n                                var centralKey = Math.round(c2.length/2);\n                                //console.log(c2[centralKey]);\n                                labelPos = c2[centralKey].reverse();\n                                labelClassName = 'path-label';\n                            }\n                            else {\n                                labelPos = l.getBounds().getCenter();\n                                //console.log(labelPos);\n                                labelClassName = 'path-label';\n                            }\n                            // without Leaflet.label\n                            var label = L.marker(labelPos, {\n                                zIndexOffset: 1,\n                                icon: L.divIcon({\n                                    iconSize: null,\n                                    className: labelClassName,\n                                    html: '<div>' + labelText + '</div>'\n                                })\n                            });\n\n                            labelsLayer.addLayer(label);\n                        }\n                    }\n                });\n\n                lyr = L.layerGroup([lyr, labelsLayer]);\n\n                layers.push({ type: 'FL', title: layer.title || '', layer: lyr });\n\n                return lyr;\n            }\n        }\n        else {\n            console.log('create ArcGISFeatureLayer (without layerDefinition.drawingInfo)');\n            var where = '1=1';\n\n            if(layer.layerDefinition.definitionExpression !== undefined) {\n                where = layer.layerDefinition.definitionExpression;\n            }\n\n            var lyr = L.esri.featureLayer({\n                url: layer.url,\n                where: where,\n                onEachFeature: function (geojson, l) {\n                    if(layer.popupInfo !== undefined) {\n                        var popupContent = createPopupContent(layer.popupInfo, geojson.properties);\n                        l.bindPopup(popupContent);\n                    }\n                }\n            });\n\n            /*lyr.metadata(function(error, response) {\n                console.log(error, response);\n            }, function(error) { console.log(error); });*/\n\n            layers.push({ type: 'FL', title: layer.title || '', layer: lyr });\n\n            return lyr;\n        }\n    }\n    else if(layer.layerType === 'ArcGISFeatureLayer') {\n        console.log('create ArcGISFeatureLayer');\n        var lyr = L.esri.featureLayer({\n            url: layer.url,\n            onEachFeature: function (geojson, l) {\n                if(layer.popupInfo !== undefined) {\n                    var popupContent = createPopupContent(layer.popupInfo, geojson.properties);\n                    l.bindPopup(popupContent);\n                }\n            },\n            pointToLayer: function (geojson, latlng) {\n\n                var f = L.marker(latlng, {\n                    //icon: icon,\n                    opacity: layer.opacity\n                });\n\n                return f;\n            }\n        });\n\n        /*lyr.metadata(function(error, response) {\n            console.log(error, response);\n        }, function(error) { console.log(error); });*/\n\n        layers.push({ type: 'FL', title: layer.title || '', layer: lyr });\n\n        return lyr;\n    }\n    else if(layer.layerType === 'ArcGISImageServiceLayer') {\n        console.log('create ArcGISImageServiceLayer');\n        var lyr = L.esri.imageMapLayer({\n            url: layer.url\n        });\n\n        layers.push({ type: 'IML', title: layer.title || '', layer: lyr });\n\n        return lyr;\n    }\n    else if(layer.layerType === 'ArcGISMapServiceLayer') {\n        var lyr = L.esri.dynamicMapLayer({\n            url: layer.url\n        });\n\n        layers.push({ type: 'DML', title: layer.title || '', layer: lyr });\n\n        return lyr;\n    }\n    else if(layer.layerType === 'ArcGISTiledMapServiceLayer') {\n    try {\n    var lyr = L.esri.basemapLayer(layer.title);\n    }\n    catch (e) {\n    var lyr = L.esri.tiledMapLayer({\n            url: layer.url\n        });\n\n    L.esri.request(layer.url, {}, function (err, res) {\n        var maxWidth = (map.getSize().x - 55);\n        var tiledAttribution = '<span class=\"esri-attributions\" style=\"line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block; max-width:' + maxWidth + 'px;\">' + res.copyrightText + '</span>'\n        map.attributionControl.addAttribution(tiledAttribution);\n    });\n    }\n\n    layers.push({ type: 'TML', title: layer.title || '', layer: lyr });\n    return lyr;\n\n    }\n    else if(layer.layerType === 'OpenStreetMap') {\n        var lyr = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n        });\n\n        layers.push({ type: 'TL', title: layer.title || layer.id || '', layer: lyr });\n\n        return lyr;\n    }\n    else if(layer.layerType === 'WebTiledLayer') {\n        var lyrUrl = _esriWTLUrlTemplateToLeaflet(layer.templateUrl);\n        var lyr = L.tileLayer(lyrUrl, {\n            attribution: layer.copyright\n        });\n\n        layers.push({ type: 'TL', title: layer.title || layer.id || '', layer: lyr });\n\n        return lyr;\n    }\n    else if(layer.layerType === '') {\n        return false;\n    }\n    else {\n        var lyr = L.featureGroup([]);\n        console.log('Unsupported Layer: ', layer);\n        return lyr;\n    }\n}\n\n\n// i will duplicate the below functions\n// and replace esri-leaflet-renderers.\nexport function _pointSymbol (symbol) {\n    var icon;\n\n        if(symbol.type === 'esriPMS') {\n            var iconUrl = symbol.url;\n\n            if(symbol.imageData !== undefined) {\n                iconUrl = 'data:' + symbol.contentType + ';base64,' + symbol.imageData;\n            }\n\n            icon = L.icon({\n                iconUrl: iconUrl,\n                shadowUrl: '',\n                iconSize:     [(symbol.height*4/3), (symbol.width*4/3)],\n                shadowSize:   [0, 0],\n                iconAnchor:   [(symbol.height*4/3)-16, (symbol.width*4/3)-1],\n                shadowAnchor: [0, 0],\n                popupAnchor:  [(symbol.width*4/3)/3, (symbol.height*4/3)*-1]\n            });\n        }\n        if(symbol.type === 'esriSMS') {\n            if(symbol.style === 'esriSMSCircle') {\n                if(symbol.outline.style === 'esriSLSNull') {\n                    icon = L.vectorIcon({\n                        //className: 'my-vector-icon',\n                        svgHeight: ((symbol.size*4/3)/2 + (symbol.outline.width*4/3)) * 2,\n                        svgWidth: ((symbol.size*4/3)/2 + (symbol.outline.width*4/3)) * 2,\n                        type: 'circle',\n                        shape: {\n                            r: (symbol.size*4/3)/2 + '',\n                            cx: (symbol.size*4/3)/2 + (symbol.outline.width*4/3),\n                            cy: (symbol.size*4/3)/2 + (symbol.outline.width*4/3)\n                        },\n                        style: {\n                            fill: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n                            //stroke: '',\n                            strokeWidth: 0\n                        }\n                    });\n                }\n                else {\n                    icon = L.vectorIcon({\n                        //className: 'my-vector-icon',\n                        svgHeight: ((symbol.size*4/3)/2 + (symbol.outline.width*4/3)) * 2,\n                        svgWidth: ((symbol.size*4/3)/2 + (symbol.outline.width*4/3)) * 2,\n                        type: 'circle',\n                        shape: {\n                            r: (symbol.size*4/3)/2 + '',\n                            cx: (symbol.size*4/3)/2 + (symbol.outline.width*4/3),\n                            cy: (symbol.size*4/3)/2 + (symbol.outline.width*4/3)\n                        },\n                        style: {\n                            fill: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n                            stroke: 'rgba(' + symbol.outline.color[0] + ',' + symbol.outline.color[1] + ',' + symbol.outline.color[2] + ',' + symbol.outline.color[3]/255 + ')',\n                            strokeWidth: (symbol.outline.width*4/3)\n                        }\n                    });\n                }\n            }\n            else if(symbol.style === 'esriSMSSquare') {\n                if(symbol.outline.style === 'esriSLSNull') {\n                    icon = L.vectorIcon({\n                        //className: 'my-vector-icon',\n                        svgHeight: (symbol.size*4/3) + (symbol.outline.width*4/3) * 2 + 2,\n                        svgWidth: (symbol.size*4/3) + (symbol.outline.width*4/3) * 2 + 2,\n                        type: 'rect',\n                        shape: {\n                            x: '1',\n                            y: '1',\n                            width: (symbol.size*4/3) + '',\n                            height: (symbol.size*4/3) + ''\n                        },\n                        style: {\n                            fill: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n                            //stroke: '',\n                            strokeWidth: 0\n                        }\n                    });\n                }\n                else {\n                    icon = L.vectorIcon({\n                        //className: 'my-vector-icon',\n                        svgHeight: (symbol.size*4/3) + (symbol.outline.width*4/3) * 2 + 2,\n                        svgWidth: (symbol.size*4/3) + (symbol.outline.width*4/3) * 2 + 2,\n                        type: 'rect',\n                        shape: {\n                            x: '1',\n                            y: '1',\n                            width: (symbol.size*4/3) + '',\n                            height: (symbol.size*4/3) + ''\n                        },\n                        style: {\n                            fill: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n                            stroke: 'rgba(' + symbol.outline.color[0] + ',' + symbol.outline.color[1] + ',' + symbol.outline.color[2] + ',' + symbol.outline.color[3]/255 + ')',\n                            strokeWidth: (symbol.outline.width*4/3)\n                        }\n                    });\n                }\n            }\n            /*else if(symbol.style === 'esriSMSDiamond') {\n                if(symbol.outline.style === 'esriSLSNull') {\n\n                }\n                else {\n\n                }\n            }*/\n            else if(symbol.style === '') {\n                if(symbol.outline.style === 'esriSLSNull') {\n\n                }\n                else {\n\n                }\n            }\n            // Other SMSs -> Circle\n            else {\n                if(symbol.outline.style === 'esriSLSNull') {\n                    icon = L.vectorIcon({\n                        //className: 'my-vector-icon',\n                        svgHeight: ((symbol.size*4/3) + (symbol.outline.width*4/3)) * 2,\n                        svgWidth: ((symbol.size*4/3) + (symbol.outline.width*4/3)) * 2,\n                        type: 'circle',\n                        shape: {\n                            r: (symbol.size*4/3) + '',\n                            cx: (symbol.size*4/3) + (symbol.outline.width*4/3),\n                            cy: (symbol.size*4/3) + (symbol.outline.width*4/3)\n                        },\n                        style: {\n                            fill: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n                            //stroke: '',\n                            strokeWidth: 0\n                        }\n                    });\n                }\n                else {\n                    icon = L.vectorIcon({\n                        //className: 'my-vector-icon',\n                        svgHeight: ((symbol.size*4/3) + (symbol.outline.width*4/3)) * 2,\n                        svgWidth: ((symbol.size*4/3) + (symbol.outline.width*4/3)) * 2,\n                        type: 'circle',\n                        shape: {\n                            r: (symbol.size*4/3) + '',\n                            cx: (symbol.size*4/3) + (symbol.outline.width*4/3),\n                            cy: (symbol.size*4/3) + (symbol.outline.width*4/3)\n                        },\n                        style: {\n                            fill: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n                            stroke: 'rgba(' + symbol.outline.color[0] + ',' + symbol.outline.color[1] + ',' + symbol.outline.color[2] + ',' + symbol.outline.color[3]/255 + ')',\n                            strokeWidth: (symbol.outline.width*4/3)\n                        }\n                    });\n                }\n            }\n        }\n\n        return icon;\n}\n\nexport function _pathSymbol (symbol) {\n    var style;\n\n    if(symbol.style === 'esriSLSSolid') {\n        style = {\n            color: 'rgba(' + symbol.color[0] + ',' + symbol.color[1] + ',' + symbol.color[2] + ',' + symbol.color[3]/255 + ')',\n            weight: (symbol.size*4/3) || (symbol.width*4/3)\n        }\n    }\n\n    if(symbol.style === 'esriSFSSolid') {\n        var color = symbol.color\n        var outlineColor = symbol.outline.color;\n\n        if(symbol.color === null) {\n            color = [0,0,0,0];\n        }\n\n        if(symbol.outline.color === null) {\n            outlineColor = [0,0,0,0];\n        }\n\n        style = {\n            fillColor: 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')',\n            fillOpacity: color[3]/255,\n            color: 'rgba(' + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ',' + outlineColor[3]/255 + ')',\n            weight: (symbol.outline.width*4/3)\n        }\n    }\n\n    return style;\n}\n\nexport function _calVisualVariables (symbol, visualVariables, properties) {\n    var vvSymbol = symbol;\n    //var value = properties[visualVariables[0].field];\n\n    visualVariables.map(function (vv) {\n        var value = properties[vv.field];\n\n        if(vv.type === 'sizeInfo') {\n            var rate = (value - vv.minDataValue)/(vv.maxDataValue - vv.minDataValue);\n            var submitSize = (rate * (vv.maxSize - vv.minSize)) + vv.minSize;\n            vvSymbol.size = submitSize;\n            if(value === null) {\n                vvSymbol.size = 6;\n            }\n        }\n        else if(vv.type === 'colorInfo') {\n            // Color Ramp\n            //console.log(symbol.color);\n            var stops = vv.stops;\n            //console.log(vv.stops);\n            stops.map(function(stop, i) {\n                //console.log('base color: ', stop.color);\n                if(i === 0) {\n                    if(stop.value > value) {\n                        var submitColor = stop.color;\n                        vvSymbol.color = submitColor;\n                        //console.log('min: ', vvSymbol.color);\n                    }\n                }\n                else if(i === stops.length-1) {\n                    if(stop.value <= value) {\n                        var submitColor = stop.color;\n                        vvSymbol.color = submitColor;\n                        //console.log('max: ', vvSymbol.color);\n                    }\n                }\n                else {\n                    if(stop.value > value && stops[i-1].value <= value) {\n                        var submitColor = [];\n                        var rate = (value - stops[i-1].value)/(stop.value - stops[i-1].value);\n                        vvSymbol.color.map(function(color, j) {\n                            submitColor[j] = Math.round((rate * (stop.color[j] - stops[i-1].color[j])) + stops[i-1].color[j]);\n                        });\n                        vvSymbol.color = submitColor;\n                        //console.log(vvSymbol.color);\n                    }\n                }\n            });\n        }\n    });\n\n    return vvSymbol;\n}\n\nexport function _generatePathStyle (renderer, properties) {\n    var style = {};\n\n    if(renderer.type === 'simple') {\n        style = _pathSymbol(renderer.symbol);\n    }\n\n    if(renderer.type === 'uniqueValue') {\n        renderer.uniqueValueInfos.map(function(info) {\n            if(info.value === properties[renderer.field1]) { // field2, field3は後で考えよう\n                var symbol = info.symbol;\n                if(renderer.visualVariables !== undefined) {\n                    symbol = _calVisualVariables(info.symbol, renderer.visualVariables, properties);\n                }\n                style = _pathSymbol(symbol);\n            }\n        });\n    }\n\n    if(renderer.type === 'classBreaks') {\n        renderer.classBreakInfos.map(function(info, i) {\n            var prevInfo;\n            var symbol = info.symbol;\n\n            if(i === 0) {\n                prevInfo = renderer.minValue;\n            }\n            else {\n                prevInfo = renderer.classBreakInfos[i-1].classMaxValue;\n            }\n            //console.log(info.classMaxValue, properties[renderer.field], prevInfo);\n\n            if(renderer.classBreakInfos.length === (i+1)) {\n                if(info.classMaxValue >= properties[renderer.field] && prevInfo <= properties[renderer.field]) {\n                    if(renderer.visualVariables !== undefined) {\n                        symbol = _calVisualVariables(info.symbol, renderer.visualVariables, properties);\n                    }\n                    style = _pathSymbol(info.symbol);\n                }\n            }\n            else {\n                if(info.classMaxValue > properties[renderer.field] && prevInfo <= properties[renderer.field]) {\n                    if(renderer.visualVariables !== undefined) {\n                        symbol = _calVisualVariables(info.symbol, renderer.visualVariables, properties);\n                    }\n                    style = _pathSymbol(info.symbol);\n                }\n            }\n        });\n    }\n\n    return style;\n}\n\nexport function _generateIcon (renderer, properties) {\n    //console.log(renderer);\n    var icon;\n\n    if(renderer.type === 'simple') {\n        icon = _pointSymbol(renderer.symbol);\n    }\n\n    if(renderer.type === 'uniqueValue') {\n        renderer.uniqueValueInfos.map(function(info) {\n            if(info.value === properties[renderer.field1]) { // field2, field3は後で考えよう\n                var symbol = info.symbol;\n                if(renderer.visualVariables !== undefined) {\n                    symbol = _calVisualVariables(info.symbol, renderer.visualVariables, properties);\n                }\n                //console.log(symbol);\n                icon = _pointSymbol(symbol);\n            }\n        });\n    }\n\n    if(renderer.type === 'classBreaks') {\n        renderer.classBreakInfos.map(function(info, i) {\n            var prevInfo;\n            var symbol = info.symbol;\n\n            if(i === 0) {\n                prevInfo = renderer.minValue;\n            }\n            else {\n                prevInfo = renderer.classBreakInfos[i-1].classMaxValue;\n            }\n            //console.log(info.classMaxValue, properties[renderer.field], prevInfo);\n\n            if(renderer.classBreakInfos.length === (i+1)) {\n                if(info.classMaxValue >= properties[renderer.field] && prevInfo <= properties[renderer.field]) {\n                    if(renderer.visualVariables !== undefined) {\n                        symbol = _calVisualVariables(info.symbol, renderer.visualVariables, properties);\n                    }\n                    icon = _pointSymbol(symbol);\n                }\n            }\n            else {\n                if(info.classMaxValue > properties[renderer.field] && prevInfo <= properties[renderer.field]) {\n                    if(renderer.visualVariables !== undefined) {\n                        symbol = _calVisualVariables(info.symbol, renderer.visualVariables, properties);\n                    }\n                    icon = _pointSymbol(info.symbol);\n                }\n            }\n        });\n    }\n\n    return icon;\n}\n\nexport function _esriWTLUrlTemplateToLeaflet (url) {\n    var r = /\\{([^\\]]*)\\}/g;\n    var newUrl = url;\n\n    newUrl = newUrl.replace(/\\{level}/g, '{z}');\n    newUrl = newUrl.replace(/\\{col}/g, '{x}');\n    newUrl = newUrl.replace(/\\{row}/g, '{y}');\n    //console.log(newUrl);\n\n    return newUrl;\n}\n\nexport var OperationalLayer = {\n  operationalLayer: operationalLayer\n};\n\nexport default OperationalLayer;","/*\n * L.esri.WebMap\n * A leaflet plugin to display ArcGIS Web Map. https://github.com/ynunokawa/L.esri.WebMap\n * (c) 2016 Yusuke Nunokawa\n *\n * @example\n *\n * ```js\n * var webmap = L.webmap('22c504d229f14c789c5b49ebff38b941', { map: L.map('map') });\n * ```\n */\n\nimport { version } from '../package.json';\n\nimport L from 'leaflet';\nimport { operationalLayer } from './OperationalLayer';\n\nexport var WebMap = L.Evented.extend({\n\toptions: {\n        // L.Map\n\t\tmap: {},\n        // access token for secure contents on ArcGIS Online\n        token: null\n\t},\n\n\tinitialize: function(webmapId, options) {\n\t\tL.setOptions(this, options);\n\n\t\tthis._map = this.options.map;\n        this._token = this.options.token;\n\t\tthis._webmapId = webmapId;\n        this._loaded = false;\n\t\tthis._metadataLoaded = false;\n\n        this.layers = []; // Check the layer types here -> https://github.com/ynunokawa/L.esri.WebMap/wiki/Layer-types\n        this.title = ''; // Web Map Title\n        this.bookmarks = []; // Web Map Bookmarks -> [{ name: 'Bookmark name', bounds: <L.latLngBounds> }]\n        this.portalItem = {}; // Web Map Metadata\n        \n        this.VERSION = version;\n\n\t\tthis._loadWebMapMetaData(webmapId);\n\t\tthis._loadWebMap(webmapId);\n\t},\n\n\t_loadWebMapMetaData: function(id) {\n        //console.log(this);\n        //console.log(this._token);\n\t\tvar map = this._map;\n\t\tvar webmap = this;\n\t\tvar webmapMetaDataRequestUrl = 'https://www.arcgis.com/sharing/rest/content/items/' + id;\n\n\t\tL.esri.request(webmapMetaDataRequestUrl, {}, function(error, response){\n\t\t  if(error){\n\t\t    console.log(error);\n\t\t  } else {\n\t\t    console.log('WebMap MetaData: ', response);\n            //console.log('extent: ', response.extent);\n            webmap.portalItem = response;\n            webmap.title = response.title;\n            webmap._metadataLoaded = true;\n            webmap.fire('metadataLoad');\n            map.fitBounds([response.extent[0].reverse(), response.extent[1].reverse()]);\n\t\t  }\n\t\t});\n\t},\n\n\t_loadWebMap: function(id) {\n\t\tvar map = this._map;\n        var layers = this.layers;\n\t\tvar generateEsriLayer = this._generateEsriLayer;\n\t\tvar webmapRequestUrl = 'https://www.arcgis.com/sharing/rest/content/items/' + id + '/data';\n\n\t\tL.esri.request(webmapRequestUrl, {}, function(error, response){\n\t\t  if(error){\n\t\t    console.log(error);\n\t\t  } else {\n\t\t    console.log('WebMap: ', response);\n\t\t\t\t//console.log('baseMap: ', response.baseMap);\n\t\t\t\t//console.log('operationalLayers: ', response.operationalLayers);\n\n\t\t\t\t// Add Basemap\n\t\t\t\tresponse.baseMap.baseMapLayers.map(function(baseMapLayer) {\n\t\t\t\t\tvar lyr = operationalLayer(baseMapLayer, layers, map).addTo(map);\n                    if(lyr !== undefined && baseMapLayer.visibility === true) {\n                        lyr.addTo(map);\n                    }\n\t\t\t\t}.bind(this));\n\n\t\t\t\t// Add Operational Layers\n\t\t\t\tresponse.operationalLayers.map(function(layer) {\n                    var lyr = operationalLayer(layer, layers, map);\n                    if(lyr !== undefined && layer.visibility === true) {\n                        lyr.addTo(map);\n                    }\n\t\t\t\t}.bind(this));\n\n                // Add Bookmarks\n                if(response.bookmarks !== undefined && response.bookmarks.length > 0) {\n                    response.bookmarks.map(function(bookmark) {\n                        // Esri Extent Geometry to L.latLngBounds\n                        var northEast = L.Projection.SphericalMercator.unproject(L.point(bookmark.extent.xmax, bookmark.extent.ymax));\n                        var southWest = L.Projection.SphericalMercator.unproject(L.point(bookmark.extent.xmin, bookmark.extent.ymin));\n                        var bounds = L.latLngBounds(southWest, northEast);\n                        this.bookmarks.push({ name: bookmark.name, bounds: bounds });\n                    }.bind(this));\n                }\n\n                this._loaded = true;\n                this.fire('load');\n\t\t  }\n\t\t}.bind(this));\n\t}\n});\n\nexport function webMap (webmapId, options) {\n  return new WebMap(webmapId, options);\n}\n\nexport default webMap;"],"names":["createPopupContent","popupInfo","properties","r","titleText","content","undefined","title","replace","s","m","exec","i","fieldInfos","length","visible","label","fieldName","mediaInfos","createLabelText","labelingInfo","labelText","labelExpression","operationalLayer","layer","layers","map","_generateEsriLayer","console","log","featureCollection","renderer","layerDefinition","drawingInfo","features","labels","featureSet","feature","icon","_generateIcon","attributes","mercatorToLatlng","L","Projection","SphericalMercator","unproject","point","geometry","x","y","f","marker","opacity","popupContent","bindPopup","zIndexOffset","divIcon","iconSize","className","html","push","lyr","featureGroup","labelsLayer","layerGroup","type","layerType","gradient","colorStops","stop","Math","round","ratio","color","esri","Heat","heatmapFeatureLayer","url","minOpacity","max","maxPixelIntensity","blur","blurRadius","radius","where","definitionExpression","featureLayer","ignoreRenderer","pointToLayer","geojson","latlng","style","pathOptions","_generatePathStyle","onEachFeature","l","labelPos","labelClassName","coordinates","reverse","c","centralKey","c2","getBounds","getCenter","addLayer","imageMapLayer","dynamicMapLayer","basemapLayer","e","tiledMapLayer","request","err","res","maxWidth","getSize","tiledAttribution","copyrightText","attributionControl","addAttribution","tileLayer","attribution","id","lyrUrl","_esriWTLUrlTemplateToLeaflet","templateUrl","copyright","_pointSymbol","symbol","iconUrl","imageData","contentType","shadowUrl","height","width","shadowSize","iconAnchor","shadowAnchor","popupAnchor","outline","vectorIcon","svgHeight","size","svgWidth","shape","cx","cy","fill","strokeWidth","stroke","_pathSymbol","weight","outlineColor","fillColor","fillOpacity","_calVisualVariables","visualVariables","vvSymbol","vv","value","field","rate","minDataValue","maxDataValue","submitSize","maxSize","minSize","stops","submitColor","j","uniqueValueInfos","info","field1","classBreakInfos","prevInfo","minValue","classMaxValue","newUrl","webMap","webmapId","options","WebMap","Evented","extend","token","initialize","setOptions","this","_map","_token","_webmapId","_loaded","_metadataLoaded","bookmarks","portalItem","VERSION","version","_loadWebMapMetaData","_loadWebMap","webmap","webmapMetaDataRequestUrl","error","response","fire","fitBounds","extent","webmapRequestUrl","baseMap","baseMapLayers","baseMapLayer","addTo","visibility","bind","operationalLayers","bookmark","northEast","xmax","ymax","southWest","xmin","ymin","bounds","latLngBounds","name"],"mappings":"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"}